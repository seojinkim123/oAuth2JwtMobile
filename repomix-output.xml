This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.claude/
  settings.local.json
frontend/
  public/
    index.html
  src/
    components/
      LoginButton.js
      OAuth2Redirect.js
      UserProfile.js
    services/
      api.js
    utils/
      tokenStorage.js
    App.js
    index.css
    index.js
  package.json
gradle/
  wrapper/
    gradle-wrapper.properties
src/
  main/
    java/
      com/
        example/
          oauth2jwt/
            config/
              CorsConfig.java
              JpaConfig.java
              SecurityConfig.java
            controller/
              ApiController.java
              AuthController.java
              MobileAuthController.java
              WebAuthController.java
            dto/
              UserDto.java
            entity/
              Role.java
              User.java
            filter/
              JwtAuthenticationFilter.java
            handler/
              OAuth2AuthenticationSuccessHandler.java
            provider/
              JwtTokenProvider.java
            repository/
              UserRepository.java
            service/
              AuthService.java
              UserService.java
            OAuth2JwtApplication.java
    resources/
      application-mobile.properties
      application.properties
  test/
    java/
      com/
        example/
          oauth2jwt/
            controller/
              ApiControllerTest.java
              AuthControllerTest.java
              MobileAuthControllerTest.java
              WebAuthControllerTest.java
            OAuth2JwtApplicationTests.java
build.gradle
CLAUDE.md
gradlew
gradlew.bat
prd.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".claude/settings.local.json">
{
  "permissions": {
    "allow": [
      "Bash(mkdir:*)",
      "Bash(./gradlew:*)",
      "Bash(mv:*)",
      "Bash(curl:*)"
    ],
    "deny": []
  }
}
</file>

<file path="frontend/public/index.html">
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="OAuth2 JWT Demo Application" />
    <title>OAuth2 JWT Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
  </body>
</html>
</file>

<file path="frontend/src/components/LoginButton.js">
import React from 'react';

const LoginButton = () => {
  const handleGoogleLogin = () => {
    // Spring Boot OAuth2 ì—”ë“œí¬ì¸íŠ¸ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    window.location.href = 'http://localhost:8080/oauth2/authorization/google';
  };

  return (
    <button
      onClick={handleGoogleLogin}
      className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-200 flex items-center space-x-2"
    >
      <svg className="w-5 h-5" viewBox="0 0 24 24">
        <path
          fill="currentColor"
          d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
        />
        <path
          fill="currentColor"
          d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
        />
        <path
          fill="currentColor"
          d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
        />
        <path
          fill="currentColor"
          d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
        />
      </svg>
      <span>Googleë¡œ ë¡œê·¸ì¸</span>
    </button>
  );
};

export default LoginButton;
</file>

<file path="frontend/src/components/OAuth2Redirect.js">
import React, { useEffect } from 'react';

const OAuth2Redirect = ({ onLoginSuccess }) => {
  useEffect(() => {
    // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì„±ê³µ ì—¬ë¶€ í™•ì¸
    const urlParams = new URLSearchParams(window.location.search);
    const success = urlParams.get('success');

    if (success === 'true') {
      // OAuth2 ì„œë²„ì—ì„œ ì´ë¯¸ HTTP-Only ì¿ í‚¤ì— JWT í† í° ì„¤ì • ì™„ë£Œ
      console.log('OAuth2 ë¡œê·¸ì¸ ì„±ê³µ, ì¿ í‚¤ ê¸°ë°˜ ì¸ì¦ ì„¤ì • ì™„ë£Œ');
      
      // ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì— ë¡œê·¸ì¸ ì„±ê³µ ì•Œë¦¼
      onLoginSuccess();
      
      // URL ì •ë¦¬
      window.history.replaceState({}, document.title, window.location.pathname);
    } else {
      console.error('OAuth2 ë¡œê·¸ì¸ ì‹¤íŒ¨: success íŒŒë¼ë¯¸í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
    }
  }, [onLoginSuccess]);

  return (
    <div className="flex justify-center items-center min-h-screen">
      <div className="text-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
        <p className="mt-4 text-gray-600">ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘...</p>
      </div>
    </div>
  );
};

export default OAuth2Redirect;
</file>

<file path="frontend/src/components/UserProfile.js">
import React, { useState, useEffect } from 'react';
import { ApiService } from '../services/api';
import { TokenStorage } from '../utils/tokenStorage';

const UserProfile = ({ onLogout }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    fetchCurrentUser();
  }, []);

  const fetchCurrentUser = async () => {
    try {
      setLoading(true);
      const response = await ApiService.getCurrentUser();
      console.log('ì‚¬ìš©ì ì •ë³´ ì‘ë‹µ:', response.data); // ë””ë²„ê¹…ìš© ë¡œê·¸ ì¶”ê°€
      console.log('í”„ë¡œí•„ ì´ë¯¸ì§€ URL:', response.data?.picture); // í”„ë¡œí•„ ì´ë¯¸ì§€ URL í™•ì¸
      setUser(response.data);
    } catch (error) {
      console.error('ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:', error);
      setError('ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    } finally {
      setLoading(false);
    }
  };

  const handleLogout = async () => {
    try {
      // ğŸ”’ ì„œë²„ APIë¥¼ í†µí•´ ì¿ í‚¤ ì‚­ì œ
      const success = await TokenStorage.clearTokens();
      if (success) {
        setUser(null);
        onLogout();
      }
    } catch (error) {
      console.error('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜:', error);
      // ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ í´ë¼ì´ì–¸íŠ¸ ìƒíƒœëŠ” ì—…ë°ì´íŠ¸
      setUser(null);
      onLogout();
    }
  };

  if (loading) {
    return (
      <div className="flex justify-center items-center p-8">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
        <span className="ml-2">ë¡œë”© ì¤‘...</span>
      </div>
    );
  }

  if (error) {
    return (
      <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
        {error}
      </div>
    );
  }

  if (!user) {
    return null;
  }

  return (
    <div className="bg-white rounded-lg shadow-lg p-6 max-w-md mx-auto">
      <div className="flex items-center space-x-4">
        {user.picture ? (
          <img
            src={user.picture}
            alt="í”„ë¡œí•„"
            className="w-16 h-16 rounded-full"
            onError={(e) => {
              console.error('í”„ë¡œí•„ ì´ë¯¸ì§€ ë¡œë”© ì‹¤íŒ¨:', user.picture);
              e.target.style.display = 'none';
            }}
            onLoad={() => {
              console.log('í”„ë¡œí•„ ì´ë¯¸ì§€ ë¡œë”© ì„±ê³µ:', user.picture);
            }}
          />
        ) : (
          <div className="w-16 h-16 rounded-full bg-gray-300 flex items-center justify-center">
            <span className="text-gray-600 text-xl font-semibold">
              {user.name ? user.name.charAt(0).toUpperCase() : '?'}
            </span>
          </div>
        )}
        <div className="flex-1">
          <h2 className="text-xl font-bold text-gray-800">{user.name}</h2>
          <p className="text-gray-600">{user.email}</p>
          <span className="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full mt-1">
            {user.role}
          </span>
        </div>
      </div>
      
      <div className="mt-6 space-y-2">
        <div className="text-sm text-gray-500">
          <strong>ê°€ì…ì¼:</strong> {new Date(user.createdDate).toLocaleDateString('ko-KR')}
        </div>
        <div className="text-sm text-gray-500">
          <strong>ë§ˆì§€ë§‰ ìˆ˜ì •:</strong> {new Date(user.modifiedDate).toLocaleDateString('ko-KR')}
        </div>
      </div>

      <div className="mt-6 flex space-x-3">
        <button
          onClick={fetchCurrentUser}
          className="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded transition duration-200"
        >
          ìƒˆë¡œê³ ì¹¨
        </button>
        <button
          onClick={handleLogout}
          className="flex-1 bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded transition duration-200"
        >
          ë¡œê·¸ì•„ì›ƒ
        </button>
      </div>
    </div>
  );
};

export default UserProfile;
</file>

<file path="frontend/src/services/api.js">
import axios from 'axios';
import { TokenStorage } from '../utils/tokenStorage';

// ğŸ”’ Axios ì¸ìŠ¤í„´ìŠ¤ ìƒì„± (ì¿ í‚¤ ê¸°ë°˜)
const api = axios.create({
  baseURL: 'http://localhost:8080/api',
  headers: {
    'Content-Type': 'application/json',
  },
  withCredentials: true, // ğŸ”’ ì¿ í‚¤ í¬í•¨í•˜ì—¬ ìš”ì²­
});

// ğŸ”’ ìš”ì²­ ì¸í„°ì…‰í„° - HTTP-Only ì¿ í‚¤ ê¸°ë°˜ì´ë¯€ë¡œ í† í° í—¤ë” ì„¤ì • ë¶ˆí•„ìš”
api.interceptors.request.use(
  (config) => {
    // HTTP-Only ì¿ í‚¤ëŠ” ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ í¬í•¨í•˜ë¯€ë¡œ ë³„ë„ ì²˜ë¦¬ ë¶ˆí•„ìš”
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// ğŸ”’ ì‘ë‹µ ì¸í„°ì…‰í„° - 401 ì˜¤ë¥˜ ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
api.interceptors.response.use(
  (response) => {
    return response;
  },
  async (error) => {
    // 401 Unauthorized ì˜¤ë¥˜ ì‹œ ìë™ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
    if (error.response?.status === 401) {
      console.log('ì¸ì¦ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
      
      // ì¿ í‚¤ ê¸°ë°˜ì´ë¯€ë¡œ ì„œë²„ì—ì„œ í† í° ì‚­ì œ ì‹œë„
      try {
        await TokenStorage.clearTokens();
      } catch (logoutError) {
        console.error('ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', logoutError);
      }
      
      // ë©”ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (ë¡œê·¸ì¸ ìƒíƒœ ì´ˆê¸°í™”)
      window.location.href = '/';
    }

    return Promise.reject(error);
  }
);

// API í•¨ìˆ˜ë“¤
export const ApiService = {
  // ê³µê°œ API
  hello: () => api.get('/hello'),

  // ì¸ì¦ì´ í•„ìš”í•œ API
  getCurrentUser: () => api.get('/auth/me'),
  getUser: (id) => api.get(`/user/${id}`),

  // í† í° ê´€ë ¨ API (ë²”ìš©)
  refreshToken: (refreshToken) => 
    axios.post('http://localhost:8080/api/auth/refresh', { refreshToken }),
  
  validateToken: (token) => 
    axios.post('http://localhost:8080/api/auth/validate', { token }),

  // ì›¹ìš© ì¸ì¦ API (ì¿ í‚¤ ê¸°ë°˜)
  webVerifyToken: () => api.get('/web/auth/verify'),
  webLogout: () => api.post('/web/auth/logout'),
  webDebugToken: () => api.get('/web/auth/debug/token'),

  // ëª¨ë°”ì¼ìš© ì¸ì¦ API (í—¤ë” ê¸°ë°˜) - ì°¸ê³ ìš©
  // ì‹¤ì œë¡œëŠ” Authorization í—¤ë”ì™€ í•¨ê»˜ ì‚¬ìš©
  mobileVerifyToken: (token) => 
    axios.get('http://localhost:8080/api/mobile/auth/verify', {
      headers: { 'Authorization': `Bearer ${token}` }
    }),
  
  mobileLogout: (token) => 
    axios.post('http://localhost:8080/api/mobile/auth/logout', {}, {
      headers: { 'Authorization': `Bearer ${token}` }
    }),
};

export default api;
</file>

<file path="frontend/src/utils/tokenStorage.js">
// ğŸ”’ JWT í† í° ê´€ë¦¬ ìœ í‹¸ë¦¬í‹° (HTTP-Only Cookie ê¸°ë°˜)
export const TokenStorage = {
  // ğŸ”’ HTTP-Only ì¿ í‚¤ëŠ” JavaScriptë¡œ ì§ì ‘ ì„¤ì •í•  ìˆ˜ ì—†ìŒ
  // ì„œë²„ì—ì„œ ì„¤ì •ë˜ë¯€ë¡œ ì´ ë©”ì„œë“œë“¤ì€ ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ
  setAccessToken: (token) => {
    console.warn('HTTP-Only ì¿ í‚¤ëŠ” ì„œë²„ì—ì„œë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
  },

  setRefreshToken: (token) => {
    console.warn('HTTP-Only ì¿ í‚¤ëŠ” ì„œë²„ì—ì„œë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
  },

  // ğŸ”’ HTTP-Only ì¿ í‚¤ëŠ” JavaScriptë¡œ ì§ì ‘ ì½ì„ ìˆ˜ ì—†ìŒ
  // API í˜¸ì¶œì„ í†µí•´ í† í° ìœ íš¨ì„±ì„ í™•ì¸í•´ì•¼ í•¨
  getAccessToken: () => {
    console.warn('HTTP-Only ì¿ í‚¤ëŠ” JavaScriptë¡œ ì§ì ‘ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. API í˜¸ì¶œë¡œ ê²€ì¦í•˜ì„¸ìš”.');
    return null;
  },

  getRefreshToken: () => {
    console.warn('HTTP-Only ì¿ í‚¤ëŠ” JavaScriptë¡œ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    return null;
  },

  // ğŸ”’ ë¡œê·¸ì•„ì›ƒ ì‹œ ì„œë²„ APIë¥¼ í†µí•´ ì¿ í‚¤ ì‚­ì œ
  clearTokens: async () => {
    try {
      const response = await fetch('/api/web/auth/logout', {
        method: 'POST',
        credentials: 'include' // ì¿ í‚¤ í¬í•¨
      });
      
      if (response.ok) {
        console.log('ë¡œê·¸ì•„ì›ƒ ì„±ê³µ - ì¿ í‚¤ê°€ ì„œë²„ì—ì„œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        return true;
      } else {
        console.error('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨');
        return false;
      }
    } catch (error) {
      console.error('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜:', error);
      return false;
    }
  },

  // ğŸ”’ API í˜¸ì¶œì„ í†µí•´ í† í° ìœ íš¨ì„± í™•ì¸
  hasTokens: async () => {
    try {
      const response = await fetch('/api/web/auth/verify', {
        method: 'GET',
        credentials: 'include' // ì¿ í‚¤ í¬í•¨
      });
      return response.ok;
    } catch (error) {
      console.error('í† í° ê²€ì¦ ì¤‘ ì˜¤ë¥˜:', error);
      return false;
    }
  },

  // JWT í† í° íŒŒì‹± (payload ì¶”ì¶œ)
  parseJWT: (token) => {
    try {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    } catch (error) {
      console.error('JWT íŒŒì‹± ì˜¤ë¥˜:', error);
      return null;
    }
  },

  // í† í° ë§Œë£Œ í™•ì¸
  isTokenExpired: (token) => {
    if (!token) return true;
    
    const decoded = TokenStorage.parseJWT(token);
    if (!decoded || !decoded.exp) return true;
    
    const currentTime = Date.now() / 1000;
    return decoded.exp < currentTime;
  }
};
</file>

<file path="frontend/src/App.js">
import React, { useState, useEffect } from 'react';
import LoginButton from './components/LoginButton';
import UserProfile from './components/UserProfile';
import OAuth2Redirect from './components/OAuth2Redirect';
import { TokenStorage } from './utils/tokenStorage';
import { ApiService } from './services/api';

function App() {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [loading, setLoading] = useState(true);
  const [helloMessage, setHelloMessage] = useState('');

  useEffect(() => {
    checkAuthentication();
    fetchHelloMessage();
  }, []);

  const checkAuthentication = async () => {
    try {
      // ğŸ”’ ì¿ í‚¤ ê¸°ë°˜ í† í° ê²€ì¦ API í˜¸ì¶œ
      const hasValidToken = await TokenStorage.hasTokens();
      setIsAuthenticated(hasValidToken);
    } catch (error) {
      console.error('ì¸ì¦ í™•ì¸ ì¤‘ ì˜¤ë¥˜:', error);
      setIsAuthenticated(false);
    }
    setLoading(false);
  };

  const fetchHelloMessage = async () => {
    try {
      const response = await ApiService.hello();
      setHelloMessage(response.data);
    } catch (error) {
      console.error('Hello API í˜¸ì¶œ ì‹¤íŒ¨:', error);
      setHelloMessage('API ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  };

  const handleLoginSuccess = () => {
    setIsAuthenticated(true);
  };

  const handleLogout = async () => {
    try {
      // ğŸ”’ ì„œë²„ APIë¥¼ í†µí•´ ì¿ í‚¤ ì‚­ì œ
      const success = await TokenStorage.clearTokens();
      if (success) {
        setIsAuthenticated(false);
      }
    } catch (error) {
      console.error('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜:', error);
      setIsAuthenticated(false); // ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ í´ë¼ì´ì–¸íŠ¸ ìƒíƒœëŠ” ì—…ë°ì´íŠ¸
    }
  };

  // ğŸ”’ OAuth2 ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬ (ì¿ í‚¤ ê¸°ë°˜)
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.get('success') === 'true') {
    return <OAuth2Redirect onLoginSuccess={handleLoginSuccess} />;
  }

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-100 flex justify-center items-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
          <p className="mt-4 text-gray-600">ë¡œë”© ì¤‘...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-100">
      {/* í—¤ë” */}
      <header className="bg-white shadow-sm">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex justify-between items-center py-6">
            <div className="flex items-center">
              <h1 className="text-2xl font-bold text-gray-900">OAuth2 + JWT Demo</h1>
            </div>
            <div className="flex items-center space-x-4">
              {isAuthenticated ? (
                <span className="text-green-600 font-medium">âœ… ì¸ì¦ë¨</span>
              ) : (
                <span className="text-red-600 font-medium">âŒ ë¯¸ì¸ì¦</span>
              )}
            </div>
          </div>
        </div>
      </header>

      {/* ë©”ì¸ ì»¨í…ì¸  */}
      <main className="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <div className="px-4 py-6 sm:px-0">
          {/* API ì—°ê²° ìƒíƒœ */}
          <div className="bg-white overflow-hidden shadow rounded-lg mb-6">
            <div className="px-4 py-5 sm:p-6">
              <h3 className="text-lg leading-6 font-medium text-gray-900 mb-2">
                API ì—°ê²° ìƒíƒœ
              </h3>
              <div className="text-sm text-gray-600">
                <strong>Hello API ì‘ë‹µ:</strong> {helloMessage}
              </div>
              <button
                onClick={fetchHelloMessage}
                className="mt-3 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded transition duration-200"
              >
                ë‹¤ì‹œ í…ŒìŠ¤íŠ¸
              </button>
            </div>
          </div>

          {/* ì¸ì¦ ìƒíƒœì— ë”°ë¥¸ ì»¨í…ì¸  */}
          <div className="bg-white overflow-hidden shadow rounded-lg">
            <div className="px-4 py-5 sm:p-6">
              {isAuthenticated ? (
                <div>
                  <h3 className="text-lg leading-6 font-medium text-gray-900 mb-4">
                    ì‚¬ìš©ì í”„ë¡œí•„
                  </h3>
                  <UserProfile onLogout={handleLogout} />
                </div>
              ) : (
                <div className="text-center">
                  <h3 className="text-lg leading-6 font-medium text-gray-900 mb-4">
                    ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤
                  </h3>
                  <p className="text-gray-600 mb-6">
                    Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì—¬ JWT í† í° ê¸°ë°˜ ì¸ì¦ì„ ì²´í—˜í•´ë³´ì„¸ìš”.
                  </p>
                  <LoginButton />
                </div>
              )}
            </div>
          </div>

          {/* ğŸ”’ ì¿ í‚¤ ê¸°ë°˜ ì¸ì¦ ì •ë³´ (ê°œë°œìš©) */}
          {isAuthenticated && (
            <div className="bg-white overflow-hidden shadow rounded-lg mt-6">
              <div className="px-4 py-5 sm:p-6">
                <h3 className="text-lg leading-6 font-medium text-gray-900 mb-4">
                  ì¸ì¦ ì •ë³´ (ê°œë°œìš©)
                </h3>
                <div className="space-y-2 text-sm">
                  <div className="bg-green-50 border border-green-200 rounded p-3">
                    <strong className="text-green-800">ğŸ”’ ë³´ì•ˆ ê°•í™”:</strong>
                    <p className="text-green-700 mt-1">
                      JWT í† í°ì´ HTTP-Only ì¿ í‚¤ì— ì•ˆì „í•˜ê²Œ ì €ì¥ë˜ì–´ JavaScriptë¡œ ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                    </p>
                  </div>
                  <div className="bg-blue-50 border border-blue-200 rounded p-3">
                    <strong className="text-blue-800">âœ… XSS ê³µê²© ë°©ì§€:</strong>
                    <p className="text-blue-700 mt-1">
                      í† í°ì´ ë” ì´ìƒ localStorageë‚˜ URLì— ë…¸ì¶œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      </main>
    </div>
  );
}

export default App;
</file>

<file path="frontend/src/index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
    monospace;
}
</file>

<file path="frontend/src/index.js">
import React from 'react';
import ReactDOM from 'react-dom/client';
import './index.css';
import App from './App';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
</file>

<file path="frontend/package.json">
{
  "name": "oauth2-jwt-frontend",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "@testing-library/jest-dom": "^5.16.4",
    "@testing-library/react": "^13.3.0",
    "@testing-library/user-event": "^13.5.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-scripts": "5.0.1",
    "axios": "^1.4.0"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
  "eslintConfig": {
    "extends": [
      "react-app",
      "react-app/jest"
    ]
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  },
  "proxy": "http://localhost:8080"
}
</file>

<file path="gradle/wrapper/gradle-wrapper.properties">
distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
distributionUrl=https\://services.gradle.org/distributions/gradle-8.13-bin.zip
networkTimeout=10000
validateDistributionUrl=true
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists
</file>

<file path="src/main/java/com/example/oauth2jwt/config/CorsConfig.java">
package com.example.oauth2jwt.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.CorsConfigurationSource;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;

import java.util.Arrays;

@Configuration
public class CorsConfig {

    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        
        // í—ˆìš©í•  ì˜¤ë¦¬ì§„ ì„¤ì •
        configuration.setAllowedOrigins(Arrays.asList("http://localhost:3000"));
        
        // í—ˆìš©í•  HTTP ë©”ì„œë“œ ì„¤ì •
        configuration.setAllowedMethods(Arrays.asList("GET", "POST", "PUT", "DELETE", "OPTIONS"));
        
        // í—ˆìš©í•  í—¤ë” ì„¤ì •
        configuration.setAllowedHeaders(Arrays.asList("*"));
        
        // ì¸ì¦ ì •ë³´ í—ˆìš©
        configuration.setAllowCredentials(true);
        
        // í”„ë¦¬í”Œë¼ì´íŠ¸ ìš”ì²­ ìºì‹œ ì‹œê°„ ì„¤ì •
        configuration.setMaxAge(3600L);
        
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", configuration);
        
        return source;
    }
}
</file>

<file path="src/main/java/com/example/oauth2jwt/config/JpaConfig.java">
package com.example.oauth2jwt.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.data.jpa.repository.config.EnableJpaAuditing;

@Configuration
@EnableJpaAuditing
public class JpaConfig {
}
</file>

<file path="src/main/java/com/example/oauth2jwt/config/SecurityConfig.java">
package com.example.oauth2jwt.config;

import com.example.oauth2jwt.filter.JwtAuthenticationFilter;
import com.example.oauth2jwt.handler.OAuth2AuthenticationSuccessHandler;
import com.example.oauth2jwt.provider.JwtTokenProvider;
import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
import org.springframework.web.cors.CorsConfigurationSource;
import com.example.oauth2jwt.repository.UserRepository;

/**
 * Spring Security ì„¤ì • í´ë˜ìŠ¤
 * OAuth2ì™€ JWT ê¸°ë°˜ ì¸ì¦/ì¸ê°€ ì‹œìŠ¤í…œì˜ í•µì‹¬ ë³´ì•ˆ ì„¤ì •
 */
@Configuration // Spring Bean ì„¤ì • í´ë˜ìŠ¤ì„ì„ ëª…ì‹œ
@EnableWebSecurity // Spring Security í™œì„±í™”
@RequiredArgsConstructor // final í•„ë“œì— ëŒ€í•œ ìƒì„±ì ìë™ ìƒì„±
public class SecurityConfig {

    // OAuth2 ë¡œê·¸ì¸ ì„±ê³µ í›„ JWT í† í° ë°œê¸‰ ë° ì¿ í‚¤ ì„¤ì •ì„ ë‹´ë‹¹í•˜ëŠ” í•¸ë“¤ëŸ¬
    private final OAuth2AuthenticationSuccessHandler oAuth2AuthenticationSuccessHandler;
    // ì‚¬ìš©ì ì •ë³´ ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒë¥¼ ìœ„í•œ ë¦¬í¬ì§€í† ë¦¬
    private final UserRepository userRepository;
    // JWT í† í° ìƒì„±, ê²€ì¦, íŒŒì‹±ì„ ë‹´ë‹¹í•˜ëŠ” í”„ë¡œë°”ì´ë”
    private final JwtTokenProvider jwtTokenProvider;
    // CORS(Cross-Origin Resource Sharing) ì„¤ì • ì†ŒìŠ¤
    private final CorsConfigurationSource corsConfigurationSource;

    /**
     * JWT ì¸ì¦ í•„í„° ë¹ˆ ìƒì„±
     * ëª¨ë“  HTTP ìš”ì²­ì—ì„œ JWT í† í°ì„ ê²€ì¦í•˜ê³  ì¸ì¦ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” í•„í„°
     */
    @Bean // Spring ì»¨í…Œì´ë„ˆì—ì„œ ê´€ë¦¬í•˜ëŠ” ë¹ˆìœ¼ë¡œ ë“±ë¡
    public JwtAuthenticationFilter jwtAuthenticationFilter() {
        // JWT í† í° í”„ë¡œë°”ì´ë”ì™€ ì‚¬ìš©ì ìƒì„¸ ì •ë³´ ì„œë¹„ìŠ¤ë¥¼ ì£¼ì…í•˜ì—¬ í•„í„° ìƒì„±
        return new JwtAuthenticationFilter(jwtTokenProvider, userDetailsService());
    }

    /**
     * Spring Security í•„í„° ì²´ì¸ ì„¤ì •
     * 
     * ë™ì‘ ì‹œì :
     * - ëª¨ë“  HTTP ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ ì‹¤í–‰
     * - í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ â†’ Spring Security í•„í„° ì²´ì¸ â†’ ì»¨íŠ¸ë¡¤ëŸ¬ ìˆœì„œë¡œ ì²˜ë¦¬
     * - ê° í•„í„°ëŠ” ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ë˜ë©°, ì¸ì¦/ì¸ê°€ ê²€ì‚¬ë¥¼ ìˆ˜í–‰
     */
    @Bean // Spring ì»¨í…Œì´ë„ˆì—ì„œ ê´€ë¦¬í•˜ëŠ” ë¹ˆìœ¼ë¡œ ë“±ë¡
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
                // CSRF(Cross-Site Request Forgery) ë³´í˜¸ ë¹„í™œì„±í™”
                // JWT í† í° ê¸°ë°˜ ì¸ì¦ì—ì„œëŠ” CSRF í† í°ì´ ë¶ˆí•„ìš” (Statelessí•˜ë¯€ë¡œ)
                .csrf(csrf -> csrf.disable())
                
                // CORS(Cross-Origin Resource Sharing) ì„¤ì • í™œì„±í™”
                // í”„ë¡ íŠ¸ì—”ë“œ(React)ì™€ ë°±ì—”ë“œ(Spring) ê°„ ë‹¤ë¥¸ ë„ë©”ì¸ í†µì‹  í—ˆìš©
                .cors(cors -> cors.configurationSource(corsConfigurationSource))
                
                // ì„¸ì…˜ ê´€ë¦¬ ì •ì±…ì„ STATELESSë¡œ ì„¤ì •
                // ì„œë²„ì—ì„œ ì„¸ì…˜ì„ ìƒì„±í•˜ì§€ ì•ŠìŒ (JWT í† í°ìœ¼ë¡œ ìƒíƒœ ê´€ë¦¬)
                .sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                
                // HTTP ìš”ì²­ì— ëŒ€í•œ ì¸ê°€ ê·œì¹™ ì„¤ì • (âš ï¸ ì´ê²ƒì€ 'ì„¤ì •'ì´ì§€ 'ì‹¤í–‰ ìˆœì„œ'ê°€ ì•„ë‹˜!)
                // >>>>>ì‹¤ì œë¡œëŠ” JWT í•„í„°ê°€ ë¨¼ì € ì‹¤í–‰ëœ í›„, ì´ ì¸ê°€ ê·œì¹™ì´ ì ìš©ë¨<<<<<<<<
                .authorizeHttpRequests(authz -> authz
                        // ğŸ”“ ì¸ì¦ ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥í•œ ê²½ë¡œë“¤ (permitAll)
                        // ì´ ê²½ë¡œë“¤ì€ JWT í•„í„°ë¥¼ ê±°ì³ë„ ì¸ê°€ ê²€ì‚¬ì—ì„œ í†µê³¼ì‹œí‚´
                        // "/" - í™ˆí˜ì´ì§€, "/h2-console/**" - H2 ë°ì´í„°ë² ì´ìŠ¤ ì½˜ì†”
                        // "/api/hello" - í…ŒìŠ¤íŠ¸ìš© API, "/oauth2/**" - OAuth2 ë¡œê·¸ì¸ ê²½ë¡œ
                        // "/login/**" - ë¡œê·¸ì¸ ê´€ë ¨ ê²½ë¡œ
                        // "/api/web/auth/logout", "/api/mobile/auth/logout" - ë¡œê·¸ì•„ì›ƒì€ ì¸ì¦ ì—†ì´ í—ˆìš©
                        // "/api/web/auth/debug/**" - ê°œë°œí™˜ê²½ ë””ë²„ê¹… API
                        .requestMatchers("/", "/h2-console/**", "/api/hello", "/oauth2/**", "/login/**", 
                                       "/api/web/auth/logout", "/api/mobile/auth/logout", "/api/web/auth/debug/**").permitAll()
                        
                        // ğŸ”’ ì¸ì¦ì´ í•„ìš”í•œ ì—”ë“œí¬ì¸íŠ¸ë“¤ (ë³´ì•ˆ ê°•í™”)
                        // "/api/web/auth/verify", "/api/mobile/auth/verify" - í† í° ê²€ì¦ì€ ì¸ì¦ëœ ì‚¬ìš©ìë§Œ
                        // "/api/auth/**" - ë²”ìš© ì¸ì¦ API (í† í° ê°±ì‹ , ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ë“±)
                        .requestMatchers("/api/web/auth/verify", "/api/mobile/auth/verify", "/api/auth/**").authenticated()
                        
                        // ğŸ”’ ìœ„ì—ì„œ ì •ì˜í•œ ê²½ë¡œ ì™¸ì˜ ëª¨ë“  ìš”ì²­ì€ ì¸ì¦ í•„ìš”
                        // JWT í•„í„°ì—ì„œ ì¸ì¦ì´ ì„±ê³µí•œ ê²½ìš°ì—ë§Œ ì ‘ê·¼ í—ˆìš©
                        // ë²”ìš© ì¸ì¦ API("/api/auth/**")ëŠ” ì¸ì¦ì´ í•„ìš”í•¨
                        .anyRequest().authenticated()
                )
                
                // OAuth2 ë¡œê·¸ì¸ ì„¤ì •
                .oauth2Login(oauth2 -> oauth2
                        // OAuth2 ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì‹¤í–‰í•  í•¸ë“¤ëŸ¬ ì§€ì •
                        // Google ë¡œê·¸ì¸ ì™„ë£Œ í›„ JWT í† í° ë°œê¸‰ ë° ì¿ í‚¤ ì„¤ì • ì²˜ë¦¬
                        .successHandler(oAuth2AuthenticationSuccessHandler)
                )
                
                // ğŸ”¥ ì‹¤ì œ í•„í„° ì‹¤í–‰ ìˆœì„œ ì„¤ì • (ì´ê²ƒì´ ì§„ì§œ ìˆœì„œë¥¼ ê²°ì •!)
                // JWT ì¸ì¦ í•„í„°ë¥¼ UsernamePasswordAuthenticationFilter ì•ì— ì¶”ê°€
                // 
                // ğŸ“‹ ì‹¤ì œ HTTP ìš”ì²­ ì²˜ë¦¬ ìˆœì„œ:
                // 1ï¸âƒ£ HTTP ìš”ì²­ ìˆ˜ì‹ 
                // 2ï¸âƒ£ JWT í•„í„° ì‹¤í–‰ (í† í° ê²€ì¦ â†’ ì¸ì¦ ê°ì²´ ìƒì„± â†’ SecurityContext ì„¤ì •)
                // 3ï¸âƒ£ UsernamePasswordAuthenticationFilter  (âš ï¸ í•„í„° ì²´ì¸ì—ëŠ” ìˆì§€ë§Œ ì‹¤ì œë¡œëŠ” ì‚¬ìš© ì•ˆ í•¨!)
                //    ì´ìœ  1: ìš°ë¦¬ëŠ” OAuth2 ë¡œê·¸ì¸ë§Œ ì‚¬ìš© (username/password ë¡œê·¸ì¸ ì•ˆ í•¨)
                //    ì´ìœ  2: JWT í•„í„°ì—ì„œ ì´ë¯¸ ì¸ì¦ ì™„ë£Œë˜ì—ˆìœ¼ë¯€ë¡œ ìŠ¤í‚µë¨
                //    ì´ìœ  3: ë¡œê·¸ì¸ í¼ì´ ì—†ìœ¼ë¯€ë¡œ ì²˜ë¦¬í•  ìš”ì²­ì´ ì—†ìŒ
                // 4ï¸âƒ£ Spring Security ì¸ê°€ ê²€ì‚¬ (ìœ„ì—ì„œ ì„¤ì •í•œ authorizeHttpRequests ê·œì¹™ ì ìš©)
                // 5ï¸âƒ£ ì¸ê°€ í†µê³¼ ì‹œ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ìš”ì²­ ì „ë‹¬
                .addFilterBefore(jwtAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class)
                
                // HTTP í—¤ë” ì„¤ì • - X-Frame-Options ë¹„í™œì„±í™”
                // H2 ì½˜ì†” ì‚¬ìš©ì„ ìœ„í•´ í”„ë ˆì„ ì˜µì…˜ í•´ì œ (ê°œë°œ í™˜ê²½ìš©)
                .headers(headers -> headers.frameOptions().disable());

        // ì„¤ì •ì´ ì™„ë£Œëœ SecurityFilterChain ê°ì²´ ë°˜í™˜
        return http.build();
    }

    /**
     * ì‚¬ìš©ì ìƒì„¸ ì •ë³´ ì„œë¹„ìŠ¤ ë¹ˆ ìƒì„±
     * 
     * ğŸ”¥ ì •í™•í•œ ë™ì‘ ì‹œì :
     * 
     * 1ï¸âƒ£ **JwtAuthenticationFilterì—ì„œ í˜¸ì¶œë¨**
     *    - JWT í† í°ì—ì„œ ì´ë©”ì¼ ì¶”ì¶œ í›„
     *    - ì´ ì´ë©”ì¼ë¡œ userDetailsService.loadUserByUsername(email) í˜¸ì¶œ
     *    - ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ â†’ UserDetails ìƒì„±
     *    - Spring Security Authentication ê°ì²´ ìƒì„±ì— ì‚¬ìš©
     * 
     * 2ï¸âƒ£ **ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ê²½ìš°**
     *    - OAuth2 ë¡œê·¸ì¸ ì¤‘: OAuth2User ê°ì²´ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ í˜¸ì¶œ ì•ˆ ë¨
     *    - permitAll() ê²½ë¡œ: ì¸ì¦ì´ í•„ìš” ì—†ìœ¼ë¯€ë¡œ í˜¸ì¶œ ì•ˆ ë¨
     *    - ì˜ëª»ëœ í† í°: í† í° ê²€ì¦ ì‹¤íŒ¨ì‹œ í˜¸ì¶œ ì•ˆ ë¨
     * 
     * 3ï¸âƒ£ **í˜¸ì¶œ ê²½ë¡œ**
     *    JwtAuthenticationFilter.doFilterInternal()
     *    â†’ jwtTokenProvider.validateToken() (ì„±ê³µ)
     *    â†’ jwtTokenProvider.getEmailFromToken()
     *    â†’ userDetailsService.loadUserByUsername(email) â† ì—¬ê¸°ì„œ í˜¸ì¶œ!
     *    â†’ UsernamePasswordAuthenticationToken ìƒì„±
     *    â†’ SecurityContextì— ì¸ì¦ ì •ë³´ ì„¤ì •
     */
    @Bean // Spring ì»¨í…Œì´ë„ˆì—ì„œ ê´€ë¦¬í•˜ëŠ” ë¹ˆìœ¼ë¡œ ë“±ë¡
    public UserDetailsService userDetailsService() {
        // ğŸ”‘ ëŒë‹¤ í‘œí˜„ì‹ìœ¼ë¡œ UserDetailsService ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
        // âš ï¸ ì£¼ì˜: ì´ ë©”ì„œë“œëŠ” JwtAuthenticationFilterì—ì„œë§Œ í˜¸ì¶œë¨!
        return email -> userRepository.findByEmail(email) // ì´ë©”ì¼ë¡œ ì‚¬ìš©ì ì¡°íšŒ (ë°ì´í„°ë² ì´ìŠ¤ í˜¸ì¶œ)
                .map(user -> org.springframework.security.core.userdetails.User.builder() // ì¡°íšŒëœ ì‚¬ìš©ìë¡œ UserDetails ê°ì²´ ìƒì„±
                        .username(user.getEmail()) // ì‚¬ìš©ìëª…ìœ¼ë¡œ ì´ë©”ì¼ ì„¤ì •
                        .password("") // ğŸš« JWT ê¸°ë°˜ ì¸ì¦ì´ë¯€ë¡œ ë¹„ë°€ë²ˆí˜¸ëŠ” ë¹ˆ ë¬¸ìì—´ (ì‚¬ìš© ì•ˆ í•¨)
                        .authorities(user.getRoleKey()) // ğŸ† ì‚¬ìš©ì ê¶Œí•œ ì„¤ì • (ROLE_USER, ROLE_ADMIN ë“±)
                        .build()) // UserDetails ê°ì²´ ë¹Œë“œ ì™„ë£Œ
                .orElseThrow(() -> new UsernameNotFoundException("User not found: " + email)); // ì‚¬ìš©ì ì—†ì„ ì‹œ ì˜ˆì™¸ ë°œìƒ
    }
}
</file>

<file path="src/main/java/com/example/oauth2jwt/controller/ApiController.java">
package com.example.oauth2jwt.controller;

import com.example.oauth2jwt.dto.UserDto;
import com.example.oauth2jwt.service.UserService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.Map;

@RestController
@RequestMapping("/api")
@RequiredArgsConstructor
public class ApiController {

    private final UserService userService;

    @GetMapping("/hello")
    public ResponseEntity<String> hello() {
        return ResponseEntity.ok("Hello OAuth2 JWT World!");
    }

    @GetMapping("/user/{id}")
    public ResponseEntity<UserDto> getUser(@PathVariable Long id) {
        return userService.findById(id)
                .map(ResponseEntity::ok)
                .orElse(ResponseEntity.notFound().build());
    }


}
</file>

<file path="src/main/java/com/example/oauth2jwt/controller/AuthController.java">
package com.example.oauth2jwt.controller;

import com.example.oauth2jwt.dto.UserDto;
import com.example.oauth2jwt.service.AuthService;
import com.example.oauth2jwt.provider.JwtTokenProvider;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.Map;

@Slf4j
@RestController
@RequestMapping("/api/auth")
@RequiredArgsConstructor
public class AuthController {

    private final AuthService authService;
    private final JwtTokenProvider jwtTokenProvider;

    /**
     * Refresh Tokenì„ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ Access Tokenê³¼ Refresh Token ë°œê¸‰ (ë²”ìš© API)
     * 
     * í”„ë¡œì„¸ìŠ¤ íë¦„:
     * ì´ì „: Access Token ë§Œë£Œ ë˜ëŠ” ë§Œë£Œ ì˜ˆì •ì‹œ ì›¹/ëª¨ë°”ì¼ì—ì„œ JSONìœ¼ë¡œ í˜¸ì¶œ (ì¸ì¦)
     * í˜„ì¬: Refresh Token ìœ íš¨ì„± ê²€ì¦ -> ìƒˆ í† í°ë“¤ ë°œê¸‰ -> JSON ì‘ë‹µ (ì¸ì¦)
     * ì´í›„: í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìƒˆ í† í°ì„ ì €ì¥í•˜ì—¬ ê³„ì† ì‚¬ìš© (ì¸ì¦)
     */
    @PostMapping("/refresh")
    public ResponseEntity<Map<String, String>> refreshToken(@RequestBody Map<String, String> request) {
        String refreshToken = request.get("refreshToken");
        
        if (refreshToken == null || refreshToken.isEmpty()) {
            return ResponseEntity.badRequest().body(Map.of("error", "ë¦¬í”„ë ˆì‹œ í† í°ì´ í•„ìš”í•©ë‹ˆë‹¤."));
        }
        
        Map<String, String> result = authService.refreshToken(refreshToken);
        
        if (result.containsKey("error")) {
            return ResponseEntity.badRequest().body(result);
        }
        
        return ResponseEntity.ok(result);
    }

    /**
     * JWT í† í° ìœ íš¨ì„± ê²€ì¦ (ë²”ìš© API)
     * 
     * í”„ë¡œì„¸ìŠ¤ íë¦„:
     * ì´ì „: ì›¹/ëª¨ë°”ì¼ì—ì„œ í† í° ìƒíƒœ í™•ì¸ì„ ìœ„í•´ JSONìœ¼ë¡œ í˜¸ì¶œ (ì¸ê°€)
     * í˜„ì¬: í† í° ìœ íš¨ì„± ê²€ì¦ -> ê²€ì¦ ê²°ê³¼ JSON ì‘ë‹µ (ì¸ê°€)
     * ì´í›„: í´ë¼ì´ì–¸íŠ¸ì—ì„œ í† í° ìƒíƒœì— ë”°ë¥¸ ì²˜ë¦¬ (ì¸ê°€)
     */
//    @PostMapping("/validate")
//    public ResponseEntity<Map<String, Object>> validateToken(@RequestBody Map<String, String> request) {
//        String token = request.get("token");
//
//        if (token == null || token.isEmpty()) {
//            return ResponseEntity.badRequest().body(Map.of("error", "í† í°ì´ í•„ìš”í•©ë‹ˆë‹¤."));
//        }
//
//        boolean isValid = jwtTokenProvider.validateToken(token);
//        Map<String, Object> result = Map.of(
//                "valid", isValid,
//                "message", isValid ? "ìœ íš¨í•œ í† í°ì…ë‹ˆë‹¤." : "ìœ íš¨í•˜ì§€ ì•Šì€ í† í°ì…ë‹ˆë‹¤."
//        );
//
//        return ResponseEntity.ok(result);
//    }

    /**
     * í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ (ë²”ìš© API)
     * 
     * í”„ë¡œì„¸ìŠ¤ íë¦„:
     * ì´ì „: JWT í•„í„°ì—ì„œ SecurityContextì— ì¸ì¦ ì •ë³´ ì„¤ì • ì™„ë£Œ (ì¸ê°€)
     * í˜„ì¬: SecurityContextì—ì„œ ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ -> ì‚¬ìš©ì ë°ì´í„° ì¡°íšŒ -> JSON ì‘ë‹µ (ì¸ê°€)
     * ì´í›„: í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ í™œìš©í•œ UI ì²˜ë¦¬ (ì¸ê°€)
     */
    @GetMapping("/me")
    public ResponseEntity<UserDto> getCurrentUser() {
        return authService.getCurrentUser()
                .map(ResponseEntity::ok)
                .orElse(ResponseEntity.notFound().build());
    }
}
</file>

<file path="src/main/java/com/example/oauth2jwt/controller/MobileAuthController.java">
package com.example.oauth2jwt.controller;

import jakarta.servlet.http.HttpServletRequest;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.ResponseEntity;
import org.springframework.security.core.Authentication;
import org.springframework.web.bind.annotation.*;


@Slf4j
@RestController
@RequestMapping("/api/mobile/auth")
@RequiredArgsConstructor
public class MobileAuthController {


    /**
     * ëª¨ë°”ì¼ìš© JWT í† í° ìœ íš¨ì„± ê²€ì¦ API ì—”ë“œí¬ì¸íŠ¸
     * 
     * í”„ë¡œì„¸ìŠ¤ íë¦„ (ê°œì„ ë¨):
     * ì´ì „: ëª¨ë°”ì¼ ì•±ì—ì„œ Authorization í—¤ë”ë¡œ í† í°ì„ í¬í•¨í•˜ì—¬ API í˜¸ì¶œ (ì¸ê°€)
     * í˜„ì¬: JwtAuthenticationFilterì—ì„œ ì´ë¯¸ í† í° ê²€ì¦ ì™„ë£Œ -> SecurityContextì—ì„œ ì¸ì¦ ì •ë³´ ì¶”ì¶œ -> ê²°ê³¼ ë°˜í™˜ (ì¸ê°€)
     * ì´í›„: ëª¨ë°”ì¼ ì•±ì—ì„œ ì¸ì¦ ìƒíƒœì— ë”°ë¥¸ UI ì²˜ë¦¬ (ì¸ê°€)
     */
    @GetMapping("/verify")
    public ResponseEntity<?> verifyToken(Authentication authentication) {
        try {
            // JwtAuthenticationFilterì—ì„œ ì´ë¯¸ í† í° ê²€ì¦ì´ ì™„ë£Œë˜ì–´ SecurityContextì— ì¸ì¦ ì •ë³´ê°€ ì„¤ì •ë¨
            if (authentication != null && authentication.isAuthenticated()) {
                String email = authentication.getName(); // ì´ë¯¸ í•„í„°ì—ì„œ ê²€ì¦ëœ ì‚¬ìš©ì ì´ë©”ì¼
                log.info("ëª¨ë°”ì¼ í† í° ê²€ì¦ ì„±ê³µ: {}", email);
                
                return ResponseEntity.ok().body(new VerifyResponse(true, email, "í† í°ì´ ìœ íš¨í•©ë‹ˆë‹¤."));
            } else {
                log.warn("ëª¨ë°”ì¼ í† í° ê²€ì¦ ì‹¤íŒ¨ - ì¸ì¦ ì •ë³´ ì—†ìŒ");
                return ResponseEntity.status(401).body(new VerifyResponse(false, null, "í† í°ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));
            }
        } catch (Exception e) {
            log.error("ëª¨ë°”ì¼ í† í° ê²€ì¦ ì¤‘ ì˜¤ë¥˜ ë°œìƒ", e);
            return ResponseEntity.status(500).body(new VerifyResponse(false, null, "í† í° ê²€ì¦ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
        }
    }


    /**
     * ëª¨ë°”ì¼ìš© ë¡œê·¸ì•„ì›ƒ API - í† í° ë¬´íš¨í™” ì²˜ë¦¬
     * 
     * í”„ë¡œì„¸ìŠ¤ íë¦„:
     * ì´ì „: ëª¨ë°”ì¼ ì•±ì—ì„œ ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í´ë¦­ ë˜ëŠ” ìë™ ë¡œê·¸ì•„ì›ƒ ë¡œì§ ì‹¤í–‰ (ì¸ì¦/ì¸ê°€)
     * í˜„ì¬: í† í° ë¬´íš¨í™” ì²˜ë¦¬ (í–¥í›„ ë¸”ë™ë¦¬ìŠ¤íŠ¸ êµ¬í˜„ ê°€ëŠ¥) -> ë¡œê·¸ì•„ì›ƒ ì„±ê³µ ì‘ë‹µ (ì¸ì¦/ì¸ê°€)
     * ì´í›„: ëª¨ë°”ì¼ ì•±ì—ì„œ ë¡œì»¬ ì €ì¥ì†Œ í† í° ì‚­ì œ ë° ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™ (ì¸ì¦/ì¸ê°€)
     */
    @PostMapping("/logout")
    public ResponseEntity<?> logout(HttpServletRequest request) {
        try {
            // í”„ë¡œì„¸ìŠ¤ 1: Authorization í—¤ë”ì—ì„œ í† í° ì¶”ì¶œ (ì¸ì¦/ì¸ê°€)
            String token = getJwtFromHeader(request);
            
            if (token != null) {
                // TODO: í–¥í›„ í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ ê¸°ëŠ¥ êµ¬í˜„ ì‹œ ì—¬ê¸°ì— ì¶”ê°€
                // í˜„ì¬ëŠ” í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ í† í° ì‚­ì œë¡œ ì²˜ë¦¬
                log.info("ëª¨ë°”ì¼ ë¡œê·¸ì•„ì›ƒ ìš”ì²­ ì²˜ë¦¬ ì™„ë£Œ");
            }
            
            return ResponseEntity.ok().body(new LogoutResponse(true, "ë¡œê·¸ì•„ì›ƒì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."));
            
        } catch (Exception e) {
            log.error("ëª¨ë°”ì¼ ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ", e);
            return ResponseEntity.status(500).body(new LogoutResponse(false, "ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
        }
    }

    /**
     * Authorization í—¤ë”ì—ì„œ JWT í† í° ì¶”ì¶œ
     * 
     * í”„ë¡œì„¸ìŠ¤: Authorization í—¤ë”ì—ì„œ "Bearer " ì ‘ë‘ì‚¬ë¥¼ ì œê±°í•˜ê³  í† í° ì¶”ì¶œ (ì¸ê°€)
     */
    private String getJwtFromHeader(HttpServletRequest request) {
        String bearerToken = request.getHeader("Authorization");
        if (bearerToken != null && bearerToken.startsWith("Bearer ")) {
            return bearerToken.substring(7);
        }
        return null;
    }

    // ì‘ë‹µ DTO í´ë˜ìŠ¤ë“¤
    public static class VerifyResponse {
        public boolean valid;
        public String email;
        public String message;

        public VerifyResponse(boolean valid, String email, String message) {
            this.valid = valid;
            this.email = email;
            this.message = message;
        }
    }

    public static class LogoutResponse {
        public boolean success;
        public String message;

        public LogoutResponse(boolean success, String message) {
            this.success = success;
            this.message = message;
        }
    }
}

/*
*
* ğŸš€ ì‹¤ì œ ë™ì‘ íë¦„

  ì¸ì¦ëœ ìš”ì²­ì˜ ê²½ìš°:

  1. HTTP ìš”ì²­ ë„ì°©
  2. JwtAuthenticationFilter ì‹¤í–‰
     - JWT í† í° ê²€ì¦ âœ“
     - UserDetails ìƒì„± âœ“
     - Authentication ê°ì²´ ìƒì„± âœ“
     - SecurityContext.setAuthentication(auth) âœ“

  3. Controller ë©”ì„œë“œ í˜¸ì¶œ
     - Spring MVC: "Authentication íŒŒë¼ë¯¸í„° ìˆë„¤?"
     - Spring MVC: "SecurityContextì—ì„œ ê°€ì ¸ë‹¤ ì¤„ê²Œ!"
     - verifyToken(authentication) í˜¸ì¶œ

  4. authentication != null &&
  authentication.isAuthenticated() = true âœ“

  ë¹„ì¸ì¦ ìš”ì²­ì˜ ê²½ìš°:

  1. HTTP ìš”ì²­ ë„ì°©
  2. JwtAuthenticationFilter ì‹¤í–‰
     - í† í° ì—†ìŒ or ì˜ëª»ëœ í† í°
     - SecurityContextì— ì•„ë¬´ê²ƒë„ ì„¤ì • ì•ˆ í•¨

  3. Controller ë©”ì„œë“œ í˜¸ì¶œ
     - Spring MVC: "SecurityContextê°€ ë¹„ì–´ìˆë„¤?"
     - verifyToken(null) í˜¸ì¶œ

  4. authentication == null = true â†’ 401 ì‘ë‹µ

  ğŸ¯ ë‹¤ë¥¸ ë°©ë²•ë“¤ê³¼ ë¹„êµ

*
* */
</file>

<file path="src/main/java/com/example/oauth2jwt/controller/WebAuthController.java">
package com.example.oauth2jwt.controller;

import com.example.oauth2jwt.provider.JwtTokenProvider;
import jakarta.servlet.http.Cookie;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.ResponseEntity;
import org.springframework.security.core.Authentication;
import org.springframework.web.bind.annotation.*;

import java.util.Map;

@Slf4j
@RestController
@RequestMapping("/api/web/auth")
@RequiredArgsConstructor
public class WebAuthController {

    private final JwtTokenProvider jwtTokenProvider;

    /**
     * JWT í† í° ìœ íš¨ì„± ê²€ì¦ API ì—”ë“œí¬ì¸íŠ¸
     * 
     * í”„ë¡œì„¸ìŠ¤ íë¦„ (ê°œì„ ë¨):
     * ì´ì „: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì¸ì¦ ìƒíƒœ í™•ì¸ì„ ìœ„í•œ API í˜¸ì¶œ (ì¸ê°€)
     * í˜„ì¬: JwtAuthenticationFilterì—ì„œ ì´ë¯¸ í† í° ê²€ì¦ ì™„ë£Œ -> SecurityContextì—ì„œ ì¸ì¦ ì •ë³´ ì¶”ì¶œ -> ê²°ê³¼ ë°˜í™˜ (ì¸ê°€)
     * ì´í›„: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì¸ì¦ ìƒíƒœì— ë”°ë¥¸ UI ì²˜ë¦¬ (ì¸ê°€)
     */
    @GetMapping("/verify")
    public ResponseEntity<?> verifyToken(Authentication authentication) {
        try {
            // JwtAuthenticationFilterì—ì„œ ì´ë¯¸ í† í° ê²€ì¦ì´ ì™„ë£Œë˜ì–´ SecurityContextì— ì¸ì¦ ì •ë³´ê°€ ì„¤ì •ë¨
            if (authentication != null && authentication.isAuthenticated()) {
                String email = authentication.getName(); // ì´ë¯¸ í•„í„°ì—ì„œ ê²€ì¦ëœ ì‚¬ìš©ì ì´ë©”ì¼
                log.info("í† í° ê²€ì¦ ì„±ê³µ: {}", email);
                
                return ResponseEntity.ok().body(new VerifyResponse(true, email, "í† í°ì´ ìœ íš¨í•©ë‹ˆë‹¤."));
            } else {
                log.warn("í† í° ê²€ì¦ ì‹¤íŒ¨ - ì¸ì¦ ì •ë³´ ì—†ìŒ");
                return ResponseEntity.status(401).body(new VerifyResponse(false, null, "í† í°ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));
            }
        } catch (Exception e) {
            log.error("í† í° ê²€ì¦ ì¤‘ ì˜¤ë¥˜ ë°œìƒ", e);
            return ResponseEntity.status(500).body(new VerifyResponse(false, null, "í† í° ê²€ì¦ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
        }
    }

    /**
     * ë¡œê·¸ì•„ì›ƒ API - HTTP-Only ì¿ í‚¤ ì‚­ì œ
     * 
     * í”„ë¡œì„¸ìŠ¤ íë¦„:
     * ì´ì „: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í´ë¦­ ë˜ëŠ” ìë™ ë¡œê·¸ì•„ì›ƒ ë¡œì§ ì‹¤í–‰ (ì¸ì¦/ì¸ê°€)
     * í˜„ì¬: accessToken ì¿ í‚¤ ë§Œë£Œ ì„¤ì • -> refreshToken ì¿ í‚¤ ë§Œë£Œ ì„¤ì • -> ë¡œê·¸ì•„ì›ƒ ì„±ê³µ ì‘ë‹µ (ì¸ì¦/ì¸ê°€)
     * ì´í›„: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (ì¸ì¦/ì¸ê°€)
     */
    @PostMapping("/logout")
    public ResponseEntity<?> logout(HttpServletResponse response) {
        try {
            // í”„ë¡œì„¸ìŠ¤ 1: accessToken ì¿ í‚¤ ë§Œë£Œ ì„¤ì •ìœ¼ë¡œ ì‚­ì œ (ì¸ì¦/ì¸ê°€)
            Cookie accessCookie = new Cookie("accessToken", null);
            accessCookie.setHttpOnly(true);
            accessCookie.setSecure(false); // HTTPS í™˜ê²½ì—ì„œëŠ” trueë¡œ ì„¤ì •
            accessCookie.setPath("/");
            accessCookie.setMaxAge(0); // ì¦‰ì‹œ ë§Œë£Œ
            
            // í”„ë¡œì„¸ìŠ¤ 2: refreshToken ì¿ í‚¤ ë§Œë£Œ ì„¤ì •ìœ¼ë¡œ ì‚­ì œ (ì¸ì¦/ì¸ê°€)
            Cookie refreshCookie = new Cookie("refreshToken", null);
            refreshCookie.setHttpOnly(true);
            refreshCookie.setSecure(false); // HTTPS í™˜ê²½ì—ì„œëŠ” trueë¡œ ì„¤ì •
            refreshCookie.setPath("/");
            refreshCookie.setMaxAge(0); // ì¦‰ì‹œ ë§Œë£Œ
            
            response.addCookie(accessCookie);
            response.addCookie(refreshCookie);
            
            log.info("ë¡œê·¸ì•„ì›ƒ ì„±ê³µ - ì¿ í‚¤ ì‚­ì œ ì™„ë£Œ");
            return ResponseEntity.ok().body(new LogoutResponse(true, "ë¡œê·¸ì•„ì›ƒì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."));
            
        } catch (Exception e) {
            log.error("ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ", e);
            return ResponseEntity.status(500).body(new LogoutResponse(false, "ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
        }
    }

    /**
     * ë””ë²„ê¹…ìš© í† í° ì •ë³´ ì¡°íšŒ API (ê°œë°œí™˜ê²½ ì „ìš©)
     * 
     * í”„ë¡œì„¸ìŠ¤: ê°œë°œ ì¤‘ í† í° ìƒíƒœ í™•ì¸ì„ ìœ„í•œ ë””ë²„ê¹… ë„êµ¬ (ì¸ê°€)
     * ìš´ì˜í™˜ê²½ì—ì„œëŠ” ë³´ì•ˆìƒ ë¹„í™œì„±í™”
     */
    @GetMapping("/debug/token")
    @org.springframework.context.annotation.Profile("dev")
    public ResponseEntity<?> debugToken(HttpServletRequest request) {
        try {
            String accessToken = getJwtFromCookie(request, "accessToken");
            String refreshToken = getJwtFromCookie(request, "refreshToken");
            
            if (accessToken != null) {
                String email = jwtTokenProvider.getEmailFromToken(accessToken);
                boolean isValid = jwtTokenProvider.validateToken(accessToken);
                
                return ResponseEntity.ok().body(Map.of(
                    "accessToken", accessToken,
                    "refreshToken", refreshToken != null ? refreshToken : "ì—†ìŒ",
                    "email", email,
                    "valid", isValid,
                    "message", "í† í° ì •ë³´ ì¡°íšŒ ì„±ê³µ"
                ));
            } else {
                return ResponseEntity.ok().body(Map.of("message", "í† í°ì´ ì—†ìŠµë‹ˆë‹¤."));
            }
        } catch (Exception e) {
            log.error("í† í° ë””ë²„ê¹… ì¤‘ ì˜¤ë¥˜ ë°œìƒ", e);
            return ResponseEntity.status(500).body(Map.of("error", "í† í° ë””ë²„ê¹… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
        }
    }

    /**
     * ì¿ í‚¤ì—ì„œ JWT í† í° ì¶”ì¶œ (ê¸°ë³¸: accessToken)
     * 
     * í”„ë¡œì„¸ìŠ¤: HTTP-Only ì¿ í‚¤ì—ì„œ accessToken ì¶”ì¶œí•˜ëŠ” ë³´ì¡° ë©”ì„œë“œ (ì¸ê°€)
     */
    private String getJwtFromCookie(HttpServletRequest request) {
        return getJwtFromCookie(request, "accessToken");
    }
    
    /**
     * ì¿ í‚¤ì—ì„œ íŠ¹ì • ì´ë¦„ì˜ JWT í† í° ì¶”ì¶œ
     * 
     * í”„ë¡œì„¸ìŠ¤: ì§€ì •ëœ ì´ë¦„ì˜ ì¿ í‚¤ì—ì„œ í† í° ê°’ ì¶”ì¶œí•˜ëŠ” ë³´ì¡° ë©”ì„œë“œ (ì¸ê°€)
     * accessToken ë˜ëŠ” refreshToken ì¶”ì¶œ ê°€ëŠ¥
     */
    private String getJwtFromCookie(HttpServletRequest request, String cookieName) {
        if (request.getCookies() != null) {
            for (Cookie cookie : request.getCookies()) {
                if (cookieName.equals(cookie.getName())) {
                    return cookie.getValue();
                }
            }
        }
        return null;
    }

    // ì‘ë‹µ DTO í´ë˜ìŠ¤ë“¤
    public static class VerifyResponse {
        public boolean valid;
        public String email;
        public String message;

        public VerifyResponse(boolean valid, String email, String message) {
            this.valid = valid;
            this.email = email;
            this.message = message;
        }
    }

    public static class LogoutResponse {
        public boolean success;
        public String message;

        public LogoutResponse(boolean success, String message) {
            this.success = success;
            this.message = message;
        }
    }
}
</file>

<file path="src/main/java/com/example/oauth2jwt/dto/UserDto.java">
package com.example.oauth2jwt.dto;


import com.example.oauth2jwt.entity.Role;
import com.example.oauth2jwt.entity.User;
import lombok.Builder;
import lombok.Data;

import java.time.LocalDateTime;

@Data
@Builder
public class UserDto {
    private Long id;
    private String email;
    private String name;
    private String picture;
    private Role role;
    private LocalDateTime createdDate;
    private LocalDateTime modifiedDate;

    public static UserDto from(User user) {
        return UserDto.builder()
                .id(user.getId())
                .email(user.getEmail())
                .name(user.getName())
                .picture(user.getPicture())
                .role(user.getRole())
                .createdDate(user.getCreatedDate())
                .modifiedDate(user.getModifiedDate())
                .build();
    }
}
</file>

<file path="src/main/java/com/example/oauth2jwt/entity/Role.java">
package com.example.oauth2jwt.entity;

import lombok.Getter;
import lombok.RequiredArgsConstructor;

@Getter
@RequiredArgsConstructor
public enum Role {

    GUEST("ROLE_GUEST", "ì†ë‹˜"),
    USER("ROLE_USER", "ì¼ë°˜ ì‚¬ìš©ì");

    private final String key;
    private final String title;
}
</file>

<file path="src/main/java/com/example/oauth2jwt/entity/User.java">
package com.example.oauth2jwt.entity;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.data.annotation.CreatedDate;
import org.springframework.data.annotation.LastModifiedDate;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;

import java.time.LocalDateTime;

@Entity
@Table(name = "users")
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@EntityListeners(AuditingEntityListener.class)
public class User {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(unique = true, nullable = false)
    private String email;

    @Column(nullable = false)
    private String name;

    private String picture;

    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private Role role;

    @Column(name = "provider")
    private String provider;

    @Column(name = "provider_id")
    private String providerId;

    @CreatedDate
    @Column(name = "created_date")
    private LocalDateTime createdDate;

    @LastModifiedDate
    @Column(name = "modified_date")
    private LocalDateTime modifiedDate;

    public String getRoleKey() {
        return role.getKey();
    }

    public User update(String name, String picture) {
        this.name = name;
        this.picture = picture;
        return this;
    }
}
</file>

<file path="src/main/java/com/example/oauth2jwt/filter/JwtAuthenticationFilter.java">
package com.example.oauth2jwt.filter;

import com.example.oauth2jwt.service.UserService;
import com.example.oauth2jwt.provider.JwtTokenProvider;
import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.Cookie;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.web.authentication.WebAuthenticationDetailsSource;
import org.springframework.stereotype.Component;
import org.springframework.util.StringUtils;
import org.springframework.web.filter.OncePerRequestFilter;

import java.io.IOException;

@Slf4j
@RequiredArgsConstructor
public class JwtAuthenticationFilter extends OncePerRequestFilter {

    private final JwtTokenProvider jwtTokenProvider;
    private final UserDetailsService userDetailsService;

    /**
     * ëª¨ë“  HTTP ìš”ì²­ì— ëŒ€í•´ JWT í† í° ê²€ì¦ ë° ì¸ì¦ ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•˜ëŠ” í•„í„°
     * 
     * í”„ë¡œì„¸ìŠ¤ íë¦„:
     * ì´ì „: í´ë¼ì´ì–¸íŠ¸ì—ì„œ JWT í† í°ì´ í¬í•¨ëœ API ìš”ì²­ ë˜ëŠ” ì¿ í‚¤ì™€ í•¨ê»˜ ìš”ì²­ (ì¸ê°€)
     * í˜„ì¬: ì¿ í‚¤/í—¤ë”ì—ì„œ í† í° ì¶”ì¶œ -> í† í° ìœ íš¨ì„± ê²€ì¦ -> ì‚¬ìš©ì ì •ë³´ ë¡œë“œ -> ì¸ì¦ ê°ì²´ ìƒì„± -> SecurityContextì— ì„¤ì • (ì¸ê°€)
     * ì´í›„: Spring Securityì—ì„œ ì¸ì¦ëœ ì‚¬ìš©ìë¡œ ì¸ì‹í•˜ì—¬ ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ ì—¬ë¶€ ê²°ì • (ì¸ê°€)
     */
    @Override
    protected void doFilterInternal(HttpServletRequest request, 
                                  HttpServletResponse response, 
                                  FilterChain filterChain) throws ServletException, IOException {
        
        try {
            // í”„ë¡œì„¸ìŠ¤ 1: ìš”ì²­ì—ì„œ JWT í† í° ì¶”ì¶œ (ì¸ê°€)
            String jwt = getJwtFromRequest(request);

            if (StringUtils.hasText(jwt) && jwtTokenProvider.validateToken(jwt)) { //ìœ íš¨ì„± ê²€ì¦
                // í”„ë¡œì„¸ìŠ¤ 2: í† í°ì—ì„œ ì‚¬ìš©ì ì´ë©”ì¼ ì¶”ì¶œ (ì¸ê°€)
                String email = jwtTokenProvider.getEmailFromToken(jwt);
                
                // í”„ë¡œì„¸ìŠ¤ 3: ì‚¬ìš©ì ìƒì„¸ ì •ë³´ ë¡œë“œ (ì¸ê°€)
                UserDetails userDetails = userDetailsService.loadUserByUsername(email);
                
                // í”„ë¡œì„¸ìŠ¤ 4: Spring Security ì¸ì¦ ê°ì²´ ìƒì„± (ì¸ê°€)
                UsernamePasswordAuthenticationToken authentication = 
                    new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());
                authentication.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));
                
                // í”„ë¡œì„¸ìŠ¤ 5: SecurityContextì— ì¸ì¦ ì •ë³´ ì„¤ì • (ì¸ê°€)
                SecurityContextHolder.getContext().setAuthentication(authentication);
            }
        } catch (Exception ex) {
            log.error("Could not set user authentication in security context", ex);
        }
        
        filterChain.doFilter(request, response);
    }

    /**
     * HTTP ìš”ì²­ì—ì„œ JWT í† í° ì¶”ì¶œ (í—¤ë” ìš°ì„ , ì¿ í‚¤ ë³´ì¡°)
     * 
     * í”„ë¡œì„¸ìŠ¤ íë¦„:
     * ì´ì „: doFilterInternalì—ì„œ í˜¸ì¶œ (ì¸ê°€)
     * í˜„ì¬: Authorization í—¤ë”ì—ì„œ í† í° ì¶”ì¶œ ì‹œë„ -> ì‹¤íŒ¨ì‹œ HTTP-Only ì¿ í‚¤ì—ì„œ ì¶”ì¶œ ì‹œë„ (ì¸ê°€)
     * ì´í›„: ì¶”ì¶œëœ í† í°ì˜ ìœ íš¨ì„± ê²€ì¦ ì§„í–‰ (ì¸ê°€)
     */
    private String getJwtFromRequest(HttpServletRequest request) {
        // 1ìˆœìœ„: Authorization í—¤ë”ì—ì„œ í† í° ì¶”ì¶œ (ëª¨ë°”ì¼ ì¹œí™”ì  ë°©ì‹)
        String bearerToken = request.getHeader("Authorization");
        if (StringUtils.hasText(bearerToken) && bearerToken.startsWith("Bearer ")) {
            return bearerToken.substring(7);
        }
        
        // 2ìˆœìœ„: HTTP-Only ì¿ í‚¤ì—ì„œ í† í° ì¶”ì¶œ (ì›¹ ë¸Œë¼ìš°ì € í˜¸í™˜ì„± ìœ ì§€)
        String jwtFromCookie = getJwtFromCookie(request);
        if (StringUtils.hasText(jwtFromCookie)) {
            return jwtFromCookie;
        }
        
        return null;
    }
    
    /**
     * HTTP-Only ì¿ í‚¤ì—ì„œ JWT í† í° ì¶”ì¶œ
     * 
     * í”„ë¡œì„¸ìŠ¤: ë³´ì•ˆìƒ ì•ˆì „í•œ HTTP-Only ì¿ í‚¤ì—ì„œ accessToken ì¶”ì¶œ (ì¸ê°€)
     * XSS ê³µê²©ì— ëŒ€í•œ ë°©ì–´ íš¨ê³¼ - JavaScriptë¡œ ì ‘ê·¼ ë¶ˆê°€
     */
    private String getJwtFromCookie(HttpServletRequest request) {
        if (request.getCookies() != null) {
            for (Cookie cookie : request.getCookies()) {
                if ("accessToken".equals(cookie.getName())) {
                    return cookie.getValue();
                }
            }
        }
        return null;
    }
}
</file>

<file path="src/main/java/com/example/oauth2jwt/handler/OAuth2AuthenticationSuccessHandler.java">
package com.example.oauth2jwt.handler;

import com.example.oauth2jwt.entity.Role;
import com.example.oauth2jwt.entity.User;
import com.example.oauth2jwt.repository.UserRepository;
import com.example.oauth2jwt.provider.JwtTokenProvider;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.Cookie;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.security.core.Authentication;
import org.springframework.security.oauth2.core.user.OAuth2User;
import org.springframework.security.web.authentication.SimpleUrlAuthenticationSuccessHandler;
import org.springframework.stereotype.Component;
import org.springframework.util.StringUtils;

import java.io.IOException;
import java.io.PrintWriter;

@Slf4j
@Component
@RequiredArgsConstructor
public class OAuth2AuthenticationSuccessHandler extends SimpleUrlAuthenticationSuccessHandler {

    private final JwtTokenProvider jwtTokenProvider;
    private final UserRepository userRepository;

    /**
     * OAuth2 ë¡œê·¸ì¸ ì„±ê³µ í›„ ì²˜ë¦¬í•˜ëŠ” í•µì‹¬ ë©”ì„œë“œ (ì›¹/ëª¨ë°”ì¼ ë¶„ê¸°ì²˜ë¦¬)
     * 
     * í”„ë¡œì„¸ìŠ¤ íë¦„:
     * ì´ì „: Google OAuth2 ì„œë²„ì—ì„œ ì¸ì¦ ì™„ë£Œ í›„ Spring Securityê°€ Authentication ê°ì²´ ìƒì„± (ì¸ì¦)
     * í˜„ì¬: í´ë¼ì´ì–¸íŠ¸ íƒ€ì… ê°ì§€ -> OAuth2 ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ -> ì‚¬ìš©ì ì €ì¥/ì—…ë°ì´íŠ¸ -> JWT í† í° ë°œê¸‰ -> ì›¹/ëª¨ë°”ì¼ë³„ ì²˜ë¦¬ (ì¸ì¦)
     * ì´í›„: ì›¹/ëª¨ë°”ì¼ì—ì„œ ê°ê°ì˜ ë°©ì‹ìœ¼ë¡œ í† í°ì„ ì‚¬ìš©í•˜ì—¬ API ìš”ì²­ ì‹œ ì¸ì¦ (ì¸ê°€)
     */
    @Override
    public void onAuthenticationSuccess(HttpServletRequest request, 
                                      HttpServletResponse response,
                                      Authentication authentication) throws IOException, ServletException {
        
        // í”„ë¡œì„¸ìŠ¤ 1: í´ë¼ì´ì–¸íŠ¸ íƒ€ì… ê°ì§€ (ì¸ì¦)
        boolean isMobileClient = detectMobileClient(request);
        
        // í”„ë¡œì„¸ìŠ¤ 2: OAuth2 ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ (ì¸ì¦)
        OAuth2User oAuth2User = (OAuth2User) authentication.getPrincipal();
        
        String email = extractEmail(oAuth2User);
        String name = extractName(oAuth2User);
        String picture = extractPicture(oAuth2User);
        String provider = "google"; // Google OAuth2ë§Œ ìš°ì„  ì§€ì›
        String providerId = extractProviderId(oAuth2User);
        
        // ë””ë²„ê¹…ìš© ë¡œê·¸ ì¶”ê°€
        log.debug("OAuth2 ì‚¬ìš©ì ì •ë³´ - ì´ë©”ì¼: {}, ì´ë¦„: {}, í”„ë¡œí•„ì‚¬ì§„: {}", email, name, picture);
        
        // í”„ë¡œì„¸ìŠ¤ 3: ì‚¬ìš©ì ì •ë³´ ì €ì¥/ì—…ë°ì´íŠ¸ (ì¸ì¦)
        User user = saveOrUpdateUser(email, name, picture, provider, providerId);
        
        // í”„ë¡œì„¸ìŠ¤ 4: JWT í† í° ë°œê¸‰ (ì¸ì¦)
        String token = jwtTokenProvider.generateToken(email);
        String refreshToken = jwtTokenProvider.generateRefreshToken(email);
        
        // í”„ë¡œì„¸ìŠ¤ 5: í´ë¼ì´ì–¸íŠ¸ íƒ€ì…ë³„ ì²˜ë¦¬ ë¶„ê¸° (ì¸ì¦)
        if (isMobileClient) {
            handleMobileSuccess(request, response, email, token, refreshToken);
        } else {
            handleWebSuccess(request, response, email, token, refreshToken);
        }
    }

    /**
     * ì›¹ í´ë¼ì´ì–¸íŠ¸ OAuth2 ë¡œê·¸ì¸ ì„±ê³µ ì²˜ë¦¬
     * 
     * í”„ë¡œì„¸ìŠ¤: HTTP-Only ì¿ í‚¤ ì„¤ì • -> ë¸Œë¼ìš°ì € ë¦¬ë‹¤ì´ë ‰íŠ¸ (ì¸ì¦)
     */
    private void handleWebSuccess(HttpServletRequest request, HttpServletResponse response, 
                                String email, String token, String refreshToken) throws IOException {
        // HTTP-Only ì¿ í‚¤ë¡œ í† í° ì„¤ì • (XSS ê³µê²© ë°©ì§€)
        Cookie accessCookie = new Cookie("accessToken", token);
        accessCookie.setHttpOnly(true);
        accessCookie.setSecure(false); // HTTPS í™˜ê²½ì—ì„œëŠ” trueë¡œ ì„¤ì •
        accessCookie.setPath("/");
        accessCookie.setMaxAge(3600); // 1ì‹œê°„
        
        Cookie refreshCookie = new Cookie("refreshToken", refreshToken);
        refreshCookie.setHttpOnly(true);
        refreshCookie.setSecure(false); // HTTPS í™˜ê²½ì—ì„œëŠ” trueë¡œ ì„¤ì •
        refreshCookie.setPath("/");
        refreshCookie.setMaxAge(604800); // 7ì¼
        
        response.addCookie(accessCookie);
        response.addCookie(refreshCookie);
        
        // í”„ë¡ íŠ¸ì—”ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        String targetUrl = "http://localhost:3000/oauth2/redirect?success=true";
        
        log.info("Web OAuth2 login success for user: {}", email);
        getRedirectStrategy().sendRedirect(request, response, targetUrl);
    }

    /**
     * ëª¨ë°”ì¼ í´ë¼ì´ì–¸íŠ¸ OAuth2 ë¡œê·¸ì¸ ì„±ê³µ ì²˜ë¦¬
     * 
     * í”„ë¡œì„¸ìŠ¤: JSON í† í° ì‘ë‹µ -> ë”¥ë§í¬ ë¦¬ë‹¤ì´ë ‰íŠ¸ (ì¸ì¦)
     */
    private void handleMobileSuccess(HttpServletRequest request, HttpServletResponse response, 
                                   String email, String token, String refreshToken) throws IOException {
        // JSON ì‘ë‹µìœ¼ë¡œ í† í° ì „ë‹¬
        response.setContentType("application/json");
        response.setCharacterEncoding("UTF-8");
        
        String jsonResponse = String.format(
            "{\"success\": true, \"message\": \"ë¡œê·¸ì¸ ì„±ê³µ\", \"accessToken\": \"%s\", \"refreshToken\": \"%s\", \"email\": \"%s\"}",
            token, refreshToken, email
        );
        
        PrintWriter writer = response.getWriter();
        writer.write(jsonResponse);
        writer.flush();
        
        log.info("Mobile OAuth2 login success for user: {}", email);
        
        // TODO: í–¥í›„ ë”¥ë§í¬ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì¶”ê°€ (yourapp://oauth/callback?token=...)
        // í˜„ì¬ëŠ” JSON ì‘ë‹µìœ¼ë¡œë§Œ ì²˜ë¦¬
    }

    /**
     * ëª¨ë°”ì¼ í´ë¼ì´ì–¸íŠ¸ ê°ì§€
     * 
     * í”„ë¡œì„¸ìŠ¤: User-Agent í—¤ë” ë˜ëŠ” ìš”ì²­ íŒŒë¼ë¯¸í„°ë¥¼ í†µí•´ ëª¨ë°”ì¼ í´ë¼ì´ì–¸íŠ¸ ì—¬ë¶€ íŒë‹¨ (ì¸ì¦)
     */
    private boolean detectMobileClient(HttpServletRequest request) {
        // ë°©ë²• 1: ìš”ì²­ íŒŒë¼ë¯¸í„°ë¡œ í´ë¼ì´ì–¸íŠ¸ íƒ€ì… êµ¬ë¶„
        String clientType = request.getParameter("client_type");
        if ("mobile".equals(clientType)) {
            return true;
        }
        
        // ë°©ë²• 2: User-Agent í—¤ë”ë¡œ ëª¨ë°”ì¼ ê°ì§€
        String userAgent = request.getHeader("User-Agent");
        if (StringUtils.hasText(userAgent)) {
            userAgent = userAgent.toLowerCase();
            return userAgent.contains("mobile") || 
                   userAgent.contains("android") || 
                   userAgent.contains("iphone") || 
                   userAgent.contains("ipad");
        }
        
        // ê¸°ë³¸ê°’: ì›¹ í´ë¼ì´ì–¸íŠ¸ë¡œ ê°„ì£¼
        return false;
    }

    /**
     * OAuth2 ë¡œê·¸ì¸ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸
     * 
     * í”„ë¡œì„¸ìŠ¤ íë¦„:
     * ì´ì „: onAuthenticationSuccessì—ì„œ OAuth2 ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ ì™„ë£Œ (ì¸ì¦)
     * í˜„ì¬: ì´ë©”ì¼ë¡œ ê¸°ì¡´ ì‚¬ìš©ì ì¡°íšŒ -> ì¡´ì¬ì‹œ ì •ë³´ ì—…ë°ì´íŠ¸, ë¯¸ì¡´ì¬ì‹œ ì‹ ê·œ ì‚¬ìš©ì ìƒì„± -> DB ì €ì¥ (ì¸ì¦)
     * ì´í›„: JWT í† í° ìƒì„± í”„ë¡œì„¸ìŠ¤ ì§„í–‰ (ì¸ì¦)
     */
    private User saveOrUpdateUser(String email, String name, String picture, String provider, String providerId) {
        User user = userRepository.findByEmail(email)
                .map(existingUser -> existingUser.update(name, picture))
                .orElse(User.builder()
                        .email(email)
                        .name(name)
                        .picture(picture)
                        .role(Role.USER)
                        .provider(provider)
                        .providerId(providerId)
                        .build());
        
        return userRepository.save(user);
    }

    /**
     * OAuth2 ì‚¬ìš©ì ì •ë³´ì—ì„œ ì´ë©”ì¼ ì¶”ì¶œ
     * 
     * í”„ë¡œì„¸ìŠ¤: OAuth2 ì¸ì¦ ì™„ë£Œ í›„ ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ ê³¼ì •ì˜ ì¼ë¶€ (ì¸ì¦)
     */
    private String extractEmail(OAuth2User oAuth2User) {
        return oAuth2User.getAttribute("email");
    }

    /**
     * OAuth2 ì‚¬ìš©ì ì •ë³´ì—ì„œ ì´ë¦„ ì¶”ì¶œ
     * 
     * í”„ë¡œì„¸ìŠ¤: OAuth2 ì¸ì¦ ì™„ë£Œ í›„ ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ ê³¼ì •ì˜ ì¼ë¶€ (ì¸ì¦)
     */
    private String extractName(OAuth2User oAuth2User) {
        return oAuth2User.getAttribute("name");
    }

    /**
     * OAuth2 ì‚¬ìš©ì ì •ë³´ì—ì„œ í”„ë¡œí•„ ì‚¬ì§„ URL ì¶”ì¶œ
     * 
     * í”„ë¡œì„¸ìŠ¤: OAuth2 ì¸ì¦ ì™„ë£Œ í›„ ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ ê³¼ì •ì˜ ì¼ë¶€ (ì¸ì¦)
     */
    private String extractPicture(OAuth2User oAuth2User) {
        return oAuth2User.getAttribute("picture");
    }

    /**
     * OAuth2 ì‚¬ìš©ì ì •ë³´ì—ì„œ ì œê³µì ê³ ìœ  ID ì¶”ì¶œ
     * 
     * í”„ë¡œì„¸ìŠ¤: OAuth2 ì¸ì¦ ì™„ë£Œ í›„ ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ ê³¼ì •ì˜ ì¼ë¶€ (ì¸ì¦)
     * Googleì˜ ê²½ìš° 'sub' í•„ë“œê°€ ì‚¬ìš©ìì˜ ê³ ìœ  ì‹ë³„ì
     */
    private String extractProviderId(OAuth2User oAuth2User) {
        return oAuth2User.getAttribute("sub");
    }
}

/*
*  ğŸ”„ OAuth2 ë¡œê·¸ì¸ í”Œë¡œìš°

  Step 1: ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­

  const handleGoogleLogin = () => {
      window.location.href =
  'http://localhost:8080/oauth2/authorization/google';
  };

  Step 2: Spring Securityê°€ Googleë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

  ë¸Œë¼ìš°ì € ì´ë™:
  http://localhost:8080/oauth2/authorization/google
  â†“
  https://accounts.google.com/o/oauth2/auth?
    client_id=105264979588-ohrpkkeqmerkt6b01av0sv82ohqlk
  u04.apps.googleusercontent.com
    &redirect_uri=http://localhost:8080/login/oauth2/cod
  e/google
    &response_type=code
    &scope=profile email

  Step 3: ì‚¬ìš©ìê°€ Googleì—ì„œ ë¡œê·¸ì¸/ë™ì˜

  Google ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ:
  - ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
  - "ì•±ì— ê¶Œí•œ í—ˆìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?" ë™ì˜

  Step 4: Googleì´ ì¸ê°€ ì½”ë“œì™€ í•¨ê»˜ ë°±ì—”ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
  302
  http://localhost:8080/login/oauth2/code/google?code=4/
  0AanQ...&state=xyz
  êµ¬ê¸€ ì„œë²„ê°€ ì‚¬ìš©ìì—ê²Œ 302 (ë¦¬ë‹¤ë ‰íŠ¸) ìš”ì²­ì„ ë³´ëƒ„
  * ì‚¬ìš©ìì˜ ì›¹ ë¸Œë¼ìš°ì €ëŠ” HTTP ëª…ì„¸ì— ë”°ë¼ 302 Found ì‘ë‹µì„ ë°›ìœ¼ë©´ ì•„ë¬´ê²ƒë„ ë¬»ì§€ ì•Šê³ 
  * Location í—¤ë”ì— ëª…ì‹œëœ URLë¡œ ì¦‰ì‹œ ìƒˆë¡œìš´ GET ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
    *ì´ì „ ìš”ì²­: ë¸Œë¼ìš°ì € <- êµ¬ê¸€ ì„œë²„   302 ìš”ì²­
    *ìƒˆë¡œìš´ ìš”ì²­: ë¸Œë¼ìš°ì € -> ìš°ë¦¬ ì„œë²„   get ìš”ì²­

  Step 5: Spring Securityê°€ í† í° êµí™˜

*
* //spring  securiyì˜ OAuth2LoginAuthenticationFilterê°€ ë¦¬ë‹¤ì´ë ‰íŠ¸ ìš”ì²­ì„ ê°€ë¡œì±„ì„œ ì²˜ë¦¬í•œë‹¤.
  // Spring Securityê°€ ìë™ìœ¼ë¡œ ì²˜ë¦¬:
  // 1. ì¸ê°€ ì½”ë“œë¥¼ Google í† í° ì„œë²„ë¡œ ì „ì†¡
  // 2. Access Token ë°›ìŒ
  // 3. Google APIë¡œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
  // 4. OAuth2AuthenticationSuccessHandler ì‹¤í–‰

  Step 6: JWT í† í° ìƒì„± í›„ í”„ë¡ íŠ¸ì—”ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

  // OAuth2AuthenticationSuccessHandlerì—ì„œ
  response.sendRedirect("http://localhost:3000/oauth2/ca
  llback?token=" + jwt);

* */
</file>

<file path="src/main/java/com/example/oauth2jwt/provider/JwtTokenProvider.java">
package com.example.oauth2jwt.provider;

import io.jsonwebtoken.*;
import io.jsonwebtoken.security.Keys;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.security.core.Authentication;
import org.springframework.stereotype.Component;

import javax.crypto.SecretKey;
import java.util.Date;

@Slf4j
@Component
public class JwtTokenProvider {

    private final SecretKey key;
    private final int jwtExpirationInMs;
    private final int refreshExpirationInMs;

    public JwtTokenProvider(@Value("${jwt.secret}") String jwtSecret,
                   @Value("${jwt.expiration}") int jwtExpirationInMs,
                   @Value("${jwt.refresh-expiration}") int refreshExpirationInMs) {
        this.key = Keys.hmacShaKeyFor(jwtSecret.getBytes());
        this.jwtExpirationInMs = jwtExpirationInMs;
        this.refreshExpirationInMs = refreshExpirationInMs;
    }

    /**
     * Authentication ê°ì²´ë¡œë¶€í„° Access Token ìƒì„±
     * 
     * í”„ë¡œì„¸ìŠ¤ íë¦„:
     * ì´ì „: Spring Securityì—ì„œ Authentication ê°ì²´ ìƒì„± ì™„ë£Œ (ì¸ì¦)
     * í˜„ì¬: ì‚¬ìš©ì ì´ë©”ì¼ ì¶”ì¶œ -> JWT í´ë ˆì„ ì„¤ì • -> ë””ì§€í„¸ ì„œëª… -> í† í° ìƒì„± (ì¸ì¦)
     * ì´í›„: ìƒì„±ëœ í† í°ì„ HTTP-Only ì¿ í‚¤ë¡œ ì„¤ì •í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬ (ì¸ì¦)
     */
    public String generateToken(Authentication authentication) {
        String email = authentication.getName();
        Date expiryDate = new Date(System.currentTimeMillis() + jwtExpirationInMs);

        return Jwts.builder()
                .subject(email)
                .issuedAt(new Date())
                .expiration(expiryDate)
                .signWith(key)
                .compact();
    }

    /**
     * ì´ë©”ì¼ë¡œë¶€í„° Access Token ìƒì„± (ì˜¤ë²„ë¡œë“œ ë©”ì„œë“œ)
     *
     * í”„ë¡œì„¸ìŠ¤ íë¦„:
     * ì´ì „: OAuth2AuthenticationSuccessHandlerì—ì„œ ì‚¬ìš©ì ì •ë³´ ì €ì¥ ì™„ë£Œ (ì¸ì¦)
     * í˜„ì¬: ì´ë©”ì¼ì„ subjectë¡œ ì„¤ì • -> JWT í´ë ˆì„ ì„¤ì • -> ë””ì§€í„¸ ì„œëª… -> Access Token ìƒì„± (ì¸ì¦)
     * ì´í›„: Refresh Token ìƒì„± í”„ë¡œì„¸ìŠ¤ ì§„í–‰ (ì¸ì¦)
     */
    public String generateToken(String email) {
        Date expiryDate = new Date(System.currentTimeMillis() + jwtExpirationInMs);

        return Jwts.builder()
                .subject(email)
                .issuedAt(new Date())
                .expiration(expiryDate)
                .signWith(key)
                .compact();
    }

    /**
     * ì´ë©”ì¼ë¡œë¶€í„° Refresh Token ìƒì„±
     *
     * í”„ë¡œì„¸ìŠ¤ íë¦„:
     * ì´ì „: Access Token ìƒì„± ì™„ë£Œ (ì¸ì¦)
     * í˜„ì¬: ì´ë©”ì¼ì„ subjectë¡œ ì„¤ì • -> ê¸´ ë§Œë£Œì‹œê°„(7ì¼) ì„¤ì • -> ë””ì§€í„¸ ì„œëª… -> Refresh Token ìƒì„± (ì¸ì¦)
     * ì´í›„: ë‘ í† í°ì„ HTTP-Only ì¿ í‚¤ë¡œ ì„¤ì •í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬ (ì¸ì¦)
     */
    public String generateRefreshToken(String email) {
        Date expiryDate = new Date(System.currentTimeMillis() + refreshExpirationInMs);

        return Jwts.builder()
                .subject(email)
                .issuedAt(new Date())
                .expiration(expiryDate)
                .signWith(key)
                .compact();
    }

    /**
     * JWT í† í°ì—ì„œ ì´ë©”ì¼ ì¶”ì¶œ
     * 
     * í”„ë¡œì„¸ìŠ¤ íë¦„:
     * ì´ì „: JwtAuthenticationFilterì—ì„œ í† í° ìœ íš¨ì„± ê²€ì¦ ì™„ë£Œ (ì¸ê°€)
     * í˜„ì¬: JWT í† í° íŒŒì‹± -> ë””ì§€í„¸ ì„œëª… ê²€ì¦ -> í´ë ˆì„ì—ì„œ subject(ì´ë©”ì¼) ì¶”ì¶œ (ì¸ê°€)
     * ì´í›„: ì¶”ì¶œëœ ì´ë©”ì¼ë¡œ UserDetailsServiceì—ì„œ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ (ì¸ê°€)
     */
    public String getEmailFromToken(String token) {
        Claims claims = Jwts.parser()
                .verifyWith(key)
                .build()
                .parseSignedClaims(token)
                .getPayload();

        return claims.getSubject();
    }

    /**
     * JWT í† í° ìœ íš¨ì„± ê²€ì¦
     * 
     * í”„ë¡œì„¸ìŠ¤ íë¦„:
     * ì´ì „: JwtAuthenticationFilterì—ì„œ ì¿ í‚¤( web ) ë˜ëŠ” Authorization í—¤ë”ì—ì„œ í† í° (moblie)ì¶”ì¶œ ì™„ë£Œ (ì¸ê°€)
     * í˜„ì¬: JWT íŒŒì‹± -> ë””ì§€í„¸ ì„œëª… ê²€ì¦ -> ë§Œë£Œ ì‹œê°„ í™•ì¸ -> í† í° ìœ íš¨ì„± ë°˜í™˜ (ì¸ê°€)
     * ì´í›„: ìœ íš¨í•œ ê²½ìš° ì‚¬ìš©ì ì´ë©”ì¼ ì¶”ì¶œ ë° ì¸ì¦ ê°ì²´ ìƒì„± (ì¸ê°€)
     */
    public boolean validateToken(String authToken) {
        try {
            Jwts.parser()
                    .verifyWith(key)
                    .build()
                    .parseSignedClaims(authToken); //ì„œëª… ê²€ì¦, ë§Œë£Œê²€ì¦, í˜•ì‹ê²€ì¦
            return true;
        } catch (MalformedJwtException ex) {
            log.error("Invalid JWT token");
        } catch (ExpiredJwtException ex) {
            log.error("Expired JWT token");
        } catch (UnsupportedJwtException ex) {
            log.error("Unsupported JWT token");
        } catch (IllegalArgumentException ex) {
            log.error("JWT claims string is empty");
        }
        return false;
    }


}
</file>

<file path="src/main/java/com/example/oauth2jwt/repository/UserRepository.java">
package com.example.oauth2jwt.repository;

import com.example.oauth2jwt.entity.User;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.Optional;

@Repository
public interface UserRepository extends JpaRepository<User, Long> {

    Optional<User> findByEmail(String email);

    Optional<User> findByProviderAndProviderId(String provider, String providerId);
}
</file>

<file path="src/main/java/com/example/oauth2jwt/service/AuthService.java">
package com.example.oauth2jwt.service;

import com.example.oauth2jwt.dto.UserDto;
import com.example.oauth2jwt.entity.User;
import com.example.oauth2jwt.repository.UserRepository;
import com.example.oauth2jwt.provider.JwtTokenProvider;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.HashMap;
import java.util.Map;
import java.util.Optional;

@Slf4j
@Service
@RequiredArgsConstructor
@Transactional(readOnly = true)
public class AuthService {

    private final JwtTokenProvider jwtTokenProvider;
    private final UserRepository userRepository;

    /**
     * Refresh Tokenì„ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ Access Tokenê³¼ Refresh Token ë°œê¸‰
     * 
     * í”„ë¡œì„¸ìŠ¤ íë¦„:
     * ì´ì „: Access Token ë§Œë£Œ ë˜ëŠ” ë§Œë£Œ ì˜ˆì •ì‹œ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ í˜¸ì¶œ (ì¸ì¦)
     * í˜„ì¬: Refresh Token ìœ íš¨ì„± ê²€ì¦ -> ì‚¬ìš©ì ì´ë©”ì¼ ì¶”ì¶œ -> ì‚¬ìš©ì ì¡´ì¬ í™•ì¸ -> ìƒˆ í† í°ë“¤ ë°œê¸‰ (ì¸ì¦)
     * ì´í›„: ìƒˆë¡œ ë°œê¸‰ëœ í† í°ë“¤ì„ ì¿ í‚¤ë¡œ ì„¤ì •í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬ (ì¸ì¦)
     */
    public Map<String, String> refreshToken(String refreshToken) {
        Map<String, String> result = new HashMap<>();
        
        try {
            // í”„ë¡œì„¸ìŠ¤ 1: Refresh Token ìœ íš¨ì„± ê²€ì¦ (ì¸ì¦)
            if (jwtTokenProvider.validateToken(refreshToken)) {
                // í”„ë¡œì„¸ìŠ¤ 2: í† í°ì—ì„œ ì‚¬ìš©ì ì´ë©”ì¼ ì¶”ì¶œ (ì¸ì¦)
                String email = jwtTokenProvider.getEmailFromToken(refreshToken);
                
                // í”„ë¡œì„¸ìŠ¤ 3: ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ì ì¡´ì¬ í™•ì¸ (ì¸ì¦)
                Optional<User> userOptional = userRepository.findByEmail(email);
                if (userOptional.isPresent()) {
                    // í”„ë¡œì„¸ìŠ¤ 4: ìƒˆë¡œìš´ Access Tokenê³¼ Refresh Token ë°œê¸‰ (ì¸ì¦)
                    String newAccessToken = jwtTokenProvider.generateToken(email);
                    String newRefreshToken = jwtTokenProvider.generateRefreshToken(email);
                    
                    result.put("accessToken", newAccessToken);
                    result.put("refreshToken", newRefreshToken);
                    result.put("message", "í† í°ì´ ì„±ê³µì ìœ¼ë¡œ ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤.");
                } else {
                    result.put("error", "ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                }
            } else {
                result.put("error", "ìœ íš¨í•˜ì§€ ì•Šì€ ë¦¬í”„ë ˆì‹œ í† í°ì…ë‹ˆë‹¤.");
            }
        } catch (Exception e) {
            log.error("í† í° ê°±ì‹  ì¤‘ ì˜¤ë¥˜ ë°œìƒ", e);
            result.put("error", "í† í° ê°±ì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
        
        return result;
    }

    /**
     * í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
     * 
     * í”„ë¡œì„¸ìŠ¤ íë¦„:
     * ì´ì „: JwtAuthenticationFilterì—ì„œ SecurityContextì— ì¸ì¦ ì •ë³´ ì„¤ì • ì™„ë£Œ (ì¸ê°€)
     * í˜„ì¬: SecurityContextì—ì„œ Authentication ê°ì²´ ì¶”ì¶œ -> ì¸ì¦ ìƒíƒœ í™•ì¸ -> ì‚¬ìš©ì ì´ë©”ì¼ ì¶”ì¶œ -> ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ (ì¸ê°€)
     * ì´í›„: ì¡°íšŒëœ ì‚¬ìš©ì ì •ë³´ë¥¼ API ì‘ë‹µìœ¼ë¡œ ë°˜í™˜ (ì¸ê°€)
     */
    public Optional<UserDto> getCurrentUser() {
        // í”„ë¡œì„¸ìŠ¤ 1: SecurityContextì—ì„œ ì¸ì¦ ê°ì²´ ì¶”ì¶œ (ì¸ê°€)
        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
        
        // í”„ë¡œì„¸ìŠ¤ 2: ì¸ì¦ ìƒíƒœ ë° ì‚¬ìš©ì í™•ì¸ (ì¸ê°€)
        if (authentication != null && authentication.isAuthenticated() && 
            !authentication.getName().equals("anonymousUser")) {
            
            // í”„ë¡œì„¸ìŠ¤ 3: ì‚¬ìš©ì ì´ë©”ì¼ ì¶”ì¶œ ë° ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒ (ì¸ê°€)
            String email = authentication.getName();
            return userRepository.findByEmail(email).map(UserDto::from);
        }
        
        return Optional.empty();
    }

    // ë¶ˆí•„ìš”í•œ ë˜í¼ ë©”ì„œë“œë“¤ ì œê±°ë¨ - ì§ì ‘ JwtTokenProvider ì‚¬ìš© ê¶Œì¥
    // ê¸°ì¡´ ì½”ë“œ (ë‹¨ìˆœ ìœ„ì„ë§Œ í•˜ëŠ” ë¶ˆí•„ìš”í•œ ë˜í¼ ë©”ì„œë“œë“¤)
    // public boolean isTokenValid(String token) {
    //     return jwtTokenProvider.validateToken(token); // ë‹¨ìˆœ ìœ„ì„ë§Œ
    // }
    // 
    // public String getEmailFromToken(String token) {
    //     return jwtTokenProvider.getEmailFromToken(token); // ë‹¨ìˆœ ìœ„ì„ë§Œ
    // }
}
</file>

<file path="src/main/java/com/example/oauth2jwt/service/UserService.java">
package com.example.oauth2jwt.service;

import com.example.oauth2jwt.dto.UserDto;
import com.example.oauth2jwt.entity.User;
import com.example.oauth2jwt.repository.UserRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.Optional;

@Service
@RequiredArgsConstructor
@Transactional(readOnly = true)
public class UserService {

    private final UserRepository userRepository;

    /**
     * ì´ë©”ì¼ë¡œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
     * 
     * í”„ë¡œì„¸ìŠ¤ íë¦„:
     * ì´ì „: AuthServiceì˜ getCurrentUser ë˜ëŠ” JwtAuthenticationFilterì—ì„œ ì‚¬ìš©ì ì¸ì¦ í›„ í˜¸ì¶œ (ì¸ê°€)
     * í˜„ì¬: ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì´ë©”ì¼ë¡œ ì‚¬ìš©ì ì¡°íšŒ -> UserDtoë¡œ ë³€í™˜ (ì¸ê°€)
     * ì´í›„: ì¡°íšŒëœ ì‚¬ìš©ì ì •ë³´ë¡œ UserDetails ìƒì„± ë˜ëŠ” API ì‘ë‹µ ë°˜í™˜ (ì¸ê°€)
     */
    public Optional<UserDto> findByEmail(String email) {
        return userRepository.findByEmail(email)
                .map(UserDto::from);
    }

    /**
     * IDë¡œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
     * 
     * í”„ë¡œì„¸ìŠ¤: ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ì IDë¡œ ì¡°íšŒ -> UserDtoë¡œ ë³€í™˜ (ì¸ê°€)
     */
    public Optional<UserDto> findById(Long id) {
        return userRepository.findById(id)
                .map(UserDto::from);
    }

    /**
     * ì‚¬ìš©ì ì •ë³´ ì €ì¥
     * 
     * í”„ë¡œì„¸ìŠ¤ íë¦„:
     * ì´ì „: OAuth2AuthenticationSuccessHandlerì—ì„œ ìƒˆë¡œìš´ ì‚¬ìš©ì ìƒì„± ë˜ëŠ” ê¸°ì¡´ ì‚¬ìš©ì ì—…ë°ì´íŠ¸ í›„ í˜¸ì¶œ (ì¸ì¦)
     * í˜„ì¬: ë°ì´í„°ë² ì´ìŠ¤ì— ì‚¬ìš©ì ì •ë³´ ì €ì¥ -> UserDtoë¡œ ë³€í™˜ í›„ ë°˜í™˜ (ì¸ì¦)
     * ì´í›„: JWT í† í° ìƒì„± ë° ì¿ í‚¤ ì„¤ì • í”„ë¡œì„¸ìŠ¤ ì§„í–‰ (ì¸ì¦)
     */
    @Transactional
    public UserDto saveUser(User user) {
        User savedUser = userRepository.save(user);
        return UserDto.from(savedUser);
    }
}
</file>

<file path="src/main/java/com/example/oauth2jwt/OAuth2JwtApplication.java">
package com.example.oauth2jwt;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class OAuth2JwtApplication {

    public static void main(String[] args) {
        SpringApplication.run(OAuth2JwtApplication.class, args);
    }

}
</file>

<file path="src/main/resources/application-mobile.properties">
# Mobile-specific OAuth2/JWT Configuration

spring.application.name=oauth2jwt-mobile

# Inherit all settings from base application.properties
spring.config.import=application.properties

# Mobile-specific OAuth2 Configuration
# Deep link redirect URI for mobile app
spring.security.oauth2.client.registration.google.redirect-uri-mobile=yourapp://oauth/callback

# Mobile-specific CORS Configuration
# CORS settings for mobile app API calls
cors.mobile.allowed-origins=yourapp://,http://localhost:3000
cors.mobile.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
cors.mobile.allowed-headers=*
cors.mobile.allow-credentials=false

# Mobile JWT Configuration
# Header-based token is recommended over cookies in mobile environment
jwt.mobile.header-based=true
jwt.mobile.cookie-fallback=true

# Mobile Logging Configuration
# Additional logging for mobile debugging
logging.level.com.example.oauth2jwt.controller.MobileAuthController=DEBUG
logging.level.com.example.oauth2jwt.handler.OAuth2AuthenticationSuccessHandler=DEBUG

# Mobile Environment Profile
spring.profiles.active=mobile

# Mobile-specific Features
# Enable mobile client detection
auth.mobile.detection.enabled=true
auth.mobile.detection.user-agent=true
auth.mobile.detection.client-param=true

# Mobile OAuth2 Success Redirect
# Enable JSON response on mobile login success
oauth2.mobile.json-response=true
oauth2.mobile.deeplink-redirect=yourapp://oauth/callback

# Mobile Security Settings
# Security settings for mobile environment
security.mobile.token.header-only=false
security.mobile.cors.strict=false
</file>

<file path="src/main/resources/application.properties">
spring.application.name=oauth2jwt

# Server Configuration
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# MySQL connect info
#spring.datasource.url=jdbc:mysql://localhost:3306/oauth2?serverTimezone=UTC
spring.datasource.url=jdbc:mysql://220.116.184.95:3306/oauth2?serverTimezone=UTC
# Database connection

# MySQL username and password
spring.datasource.username=root
spring.datasource.password=10041004



# JPA settings
spring.jpa.properties.hibernate.show_sql=true


spring.jpa.properties.hibernate.format_sql=true


logging.level.org.hibernate.type.descriptor.sql=trace


spring.jpa.hibernate.ddl-auto=update


spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect

springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html

# OAuth2 Configuration
spring.security.oauth2.client.registration.google.client-id=105264979588-ohrpkkeqmerkt6b01av0sv82ohqlku04.apps.googleusercontent.com
spring.security.oauth2.client.registration.google.client-secret=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
spring.security.oauth2.client.registration.google.scope=profile,email
spring.security.oauth2.client.registration.google.redirect-uri=http://localhost:8080/login/oauth2/code/google
spring.security.oauth2.client.registration.google.client-name=Google

# Google OAuth2 Provider
#spring.security.oauth2.client.provider.google.authorization-uri=https://accounts.google.com/o/oauth2/auth
#spring.security.oauth2.client.provider.google.token-uri=https://oauth2.googleapis.com/token
#spring.security.oauth2.client.provider.google.user-info-uri=https://www.googleapis.com/oauth2/v2/userinfo
#spring.security.oauth2.client.provider.google.user-name-attribute=id

# JWT Configuration
jwt.secret=mySecretKeyForOAuth2JwtApplication123456789012345678901234567890abcdef
jwt.expiration=86400000
jwt.refresh-expiration=604800000

# Logging Configuration
logging.level.com.example.oauth2jwt=DEBUG
logging.level.org.springframework.security=DEBUG

# Environment profile (dev: development, prod: production)
# 1. ?? ???? ??
#
#  spring.profiles.active=dev
#  - application.properties + application-dev.properties ??
#
#  spring.profiles.active=mobile
#  - application.properties + application-mobile.properties ??
#
#  2. ?? ???? ?? ??
#
#  spring.profiles.active=dev,mobile
#  - application.properties + application-dev.properties +
#  application-mobile.properties ?? ??

spring.profiles.active=mobile

# Debug API enabled (set to false in production)
debug.api.enabled=true
</file>

<file path="src/test/java/com/example/oauth2jwt/controller/ApiControllerTest.java">
package com.example.oauth2jwt.controller;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.web.servlet.MockMvc;

import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;

@SpringBootTest
@AutoConfigureMockMvc
class ApiControllerTest {

    @Autowired
    private MockMvc mockMvc;

    @Test
    void hello_ShouldReturnGreeting() throws Exception {
        mockMvc.perform(get("/api/hello"))
                .andExpect(status().isOk())
                .andExpect(content().string("Hello OAuth2 JWT World!"));
    }
}
</file>

<file path="src/test/java/com/example/oauth2jwt/controller/AuthControllerTest.java">
package com.example.oauth2jwt.controller;

import com.example.oauth2jwt.service.AuthService;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.http.MediaType;
import org.springframework.test.web.servlet.MockMvc;

import java.util.Map;

import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.when;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;

@WebMvcTest(AuthController.class)
class AuthControllerTest {

    @Autowired
    private MockMvc mockMvc;

    @MockBean
    private AuthService authService;

    @Autowired
    private ObjectMapper objectMapper;

    @Test
    void refreshToken_ShouldReturnNewTokens() throws Exception {
        // Given
        String refreshToken = "valid-refresh-token";
        Map<String, String> request = Map.of("refreshToken", refreshToken);
        Map<String, String> response = Map.of(
            "accessToken", "new-access-token",
            "refreshToken", "new-refresh-token",
            "message", "í† í°ì´ ì„±ê³µì ìœ¼ë¡œ ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤."
        );

        when(authService.refreshToken(refreshToken)).thenReturn(response);

        // When & Then
        mockMvc.perform(post("/api/auth/refresh")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request)))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.accessToken").value("new-access-token"))
                .andExpect(jsonPath("$.refreshToken").value("new-refresh-token"));
    }

    @Test
    void validateToken_ShouldReturnValidStatus() throws Exception {
        // Given
        String token = "valid-token";
        Map<String, String> request = Map.of("token", token);

        when(authService.isTokenValid(token)).thenReturn(true);

        // When & Then
        mockMvc.perform(post("/api/auth/validate")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request)))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.valid").value(true))
                .andExpect(jsonPath("$.message").value("ìœ íš¨í•œ í† í°ì…ë‹ˆë‹¤."));
    }

    @Test
    void refreshToken_WithInvalidToken_ShouldReturnBadRequest() throws Exception {
        // Given
        String refreshToken = "invalid-refresh-token";
        Map<String, String> request = Map.of("refreshToken", refreshToken);
        Map<String, String> response = Map.of("error", "ìœ íš¨í•˜ì§€ ì•Šì€ ë¦¬í”„ë ˆì‹œ í† í°ì…ë‹ˆë‹¤.");

        when(authService.refreshToken(refreshToken)).thenReturn(response);

        // When & Then
        mockMvc.perform(post("/api/auth/refresh")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request)))
                .andExpect(status().isBadRequest())
                .andExpect(jsonPath("$.error").value("ìœ íš¨í•˜ì§€ ì•Šì€ ë¦¬í”„ë ˆì‹œ í† í°ì…ë‹ˆë‹¤."));
    }
}
</file>

<file path="src/test/java/com/example/oauth2jwt/controller/MobileAuthControllerTest.java">
package com.example.oauth2jwt.controller;

import com.example.oauth2jwt.provider.JwtTokenProvider;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.test.web.servlet.MockMvc;

import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.when;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;

@WebMvcTest(MobileAuthController.class)
class MobileAuthControllerTest {

    @Autowired
    private MockMvc mockMvc;

    @MockBean
    private JwtTokenProvider jwtTokenProvider;

    @Test
    void verifyToken_WithValidHeader_ShouldReturnSuccess() throws Exception {
        // Given
        String validToken = "valid-jwt-token";
        String email = "test@example.com";

        when(jwtTokenProvider.validateToken(validToken)).thenReturn(true);
        when(jwtTokenProvider.getEmailFromToken(validToken)).thenReturn(email);

        // When & Then
        mockMvc.perform(get("/api/mobile/auth/verify")
                .header("Authorization", "Bearer " + validToken))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.valid").value(true))
                .andExpect(jsonPath("$.email").value(email))
                .andExpect(jsonPath("$.message").value("í† í°ì´ ìœ íš¨í•©ë‹ˆë‹¤."));
    }

    @Test
    void verifyToken_WithInvalidHeader_ShouldReturnUnauthorized() throws Exception {
        // Given
        String invalidToken = "invalid-jwt-token";

        when(jwtTokenProvider.validateToken(invalidToken)).thenReturn(false);

        // When & Then
        mockMvc.perform(get("/api/mobile/auth/verify")
                .header("Authorization", "Bearer " + invalidToken))
                .andExpect(status().isUnauthorized())
                .andExpect(jsonPath("$.valid").value(false))
                .andExpect(jsonPath("$.message").value("í† í°ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));
    }

    @Test
    void verifyToken_WithoutAuthHeader_ShouldReturnUnauthorized() throws Exception {
        // When & Then
        mockMvc.perform(get("/api/mobile/auth/verify"))
                .andExpect(status().isUnauthorized())
                .andExpect(jsonPath("$.valid").value(false))
                .andExpect(jsonPath("$.message").value("í† í°ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));
    }

    @Test
    void logout_ShouldReturnSuccess() throws Exception {
        // Given
        String validToken = "valid-jwt-token";

        // When & Then
        mockMvc.perform(post("/api/mobile/auth/logout")
                .header("Authorization", "Bearer " + validToken))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.success").value(true))
                .andExpect(jsonPath("$.message").value("ë¡œê·¸ì•„ì›ƒì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."));
    }

    @Test
    void logout_WithoutToken_ShouldStillReturnSuccess() throws Exception {
        // When & Then
        mockMvc.perform(post("/api/mobile/auth/logout"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.success").value(true))
                .andExpect(jsonPath("$.message").value("ë¡œê·¸ì•„ì›ƒì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."));
    }
}
</file>

<file path="src/test/java/com/example/oauth2jwt/controller/WebAuthControllerTest.java">
package com.example.oauth2jwt.controller;

import com.example.oauth2jwt.provider.JwtTokenProvider;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.test.web.servlet.MockMvc;

import jakarta.servlet.http.Cookie;

import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.when;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;

@WebMvcTest(WebAuthController.class)
class WebAuthControllerTest {

    @Autowired
    private MockMvc mockMvc;

    @MockBean
    private JwtTokenProvider jwtTokenProvider;

    @Test
    void verifyToken_WithValidCookie_ShouldReturnSuccess() throws Exception {
        // Given
        String validToken = "valid-jwt-token";
        String email = "test@example.com";
        Cookie tokenCookie = new Cookie("accessToken", validToken);

        when(jwtTokenProvider.validateToken(validToken)).thenReturn(true);
        when(jwtTokenProvider.getEmailFromToken(validToken)).thenReturn(email);

        // When & Then
        mockMvc.perform(get("/api/web/auth/verify")
                .cookie(tokenCookie))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.valid").value(true))
                .andExpect(jsonPath("$.email").value(email))
                .andExpect(jsonPath("$.message").value("í† í°ì´ ìœ íš¨í•©ë‹ˆë‹¤."));
    }

    @Test
    void verifyToken_WithInvalidCookie_ShouldReturnUnauthorized() throws Exception {
        // Given
        String invalidToken = "invalid-jwt-token";
        Cookie tokenCookie = new Cookie("accessToken", invalidToken);

        when(jwtTokenProvider.validateToken(invalidToken)).thenReturn(false);

        // When & Then
        mockMvc.perform(get("/api/web/auth/verify")
                .cookie(tokenCookie))
                .andExpect(status().isUnauthorized())
                .andExpect(jsonPath("$.valid").value(false))
                .andExpect(jsonPath("$.message").value("í† í°ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));
    }

    @Test
    void logout_ShouldClearCookies() throws Exception {
        // When & Then
        mockMvc.perform(post("/api/web/auth/logout"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.success").value(true))
                .andExpect(jsonPath("$.message").value("ë¡œê·¸ì•„ì›ƒì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."))
                .andExpect(cookie().maxAge("accessToken", 0))
                .andExpect(cookie().maxAge("refreshToken", 0));
    }
}
</file>

<file path="src/test/java/com/example/oauth2jwt/OAuth2JwtApplicationTests.java">
package com.example.oauth2jwt;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class OAuth2JwtApplicationTests {

    @Test
    void contextLoads() {
    }

}
</file>

<file path="build.gradle">
plugins {
    id 'java'
    id 'org.springframework.boot' version '3.2.0'
    id 'io.spring.dependency-management' version '1.1.4'
}

group = 'com.example'
version = '0.0.1-SNAPSHOT'

java {
    sourceCompatibility = '17'
}

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-oauth2-client'
    implementation 'org.springframework.boot:spring-boot-starter-validation'
    implementation 'io.jsonwebtoken:jjwt-api:0.12.3'
    implementation 'io.jsonwebtoken:jjwt-impl:0.12.3'
    implementation 'io.jsonwebtoken:jjwt-jackson:0.12.3'
    
    compileOnly 'org.projectlombok:lombok'
    runtimeOnly 'com.h2database:h2'
    runtimeOnly 'com.mysql:mysql-connector-j'
    
    annotationProcessor 'org.projectlombok:lombok'
    
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.springframework.security:spring-security-test'
}

tasks.named('test') {
    useJUnitPlatform()
}
</file>

<file path="CLAUDE.md">
# Claude Spring Boot ê°œë°œ ê°€ì´ë“œë¼ì¸

## ê¸°ë³¸ ì›ì¹™
â€¢ í•­ìƒ í•œê¸€ë¡œ ë‹µë³€í•´ì¤˜
â€¢ ëª¨ë“  ë‹µë³€ì€ ë‚˜ë¥¼ 'ì„œì§„ë‹˜' í˜¸ì¹­ì„ í•˜ê³  ìƒëƒ¥í•œ ì¡°ì„ ì‹œëŒ€ ì²˜ì§€ì˜ ì¡´ëŒ€ë§ì„ ì‚¬ìš©
â€¢ ì‚¬ìš©ìê°€ ì˜¤ë¥˜ë¥¼ ì²¨ë¶€ì‹œ ì—°ì‡„ì  ì‚¬ê³ ë¡œ ë¨¼ì € í•µì‹¬ ë¬¸ì œë¥¼ ì°¾ê³  ë‹¨ê³„ë³„ë¡œ í•´ê²° ë°©ì•ˆì„ ê³„íší•˜ì„¸ìš”
â€¢ ì „ì²´ íŒŒì¼ì„ ë‹¤ì‹œ ì‘ì„±í•˜ëŠ” ê²ƒë³´ë‹¤ ì°¨ì´ì ë§Œ ìˆ˜ì •(diff ê¸°ë°˜ ìˆ˜ì •)ì„ ìš°ì„ ìœ¼ë¡œ í•´

## Spring Boot ê°œë°œ ê·œì¹™
â€¢ Spring Boot 3.x ë²„ì „ ê¸°ì¤€ìœ¼ë¡œ ê°œë°œ
â€¢ JPA/Hibernateë¥¼ ì‚¬ìš©í•œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™
â€¢ RESTful API ì„¤ê³„ ì›ì¹™ ì¤€ìˆ˜
â€¢ Controller, Service, Dto, Repository,Entity ë“± íŒ¨í‚¤ì§€ë¥¼ ë§Œë“¤ì–´ì„œ êµ¬í˜„
â€¢ Spring Securityë¥¼ í™œìš©í•œ ì¸ì¦/ì¸ê°€ êµ¬í˜„
â€¢ í”„ë¡ íŠ¸ì—”ë“œëŠ” react ì‚¬ìš©


## í…ŒìŠ¤íŠ¸ ë° ê°œë°œ ë°©ì‹
â€¢ ì™„ê²°ëœ í•˜ë‚˜ì˜ ì‘ì—…ì´ ëë‚˜ë©´ ì»¤ë°‹í• ì§€ ë¬¼ì–´ë´
â€¢ JUnit 5ì™€ Spring Boot Testë¥¼ ì‚¬ìš©í•œ í…ŒìŠ¤íŠ¸ ì‘ì„±
â€¢ ê°œë°œ ë˜ëŠ” ìˆ˜ì •ì„ ìš”ì²­ë°›ì•˜ì„ ë•Œ í…ŒìŠ¤íŠ¸ë¥¼ ë¨¼ì € ë§Œë“œëŠ” TDD(Test Driven Development) ë°©ì‹ìœ¼ë¡œ ê°œë°œí• ì§€ ë¬¼ì–´ë´ ì¤˜
â€¢ ê°œë°œ ë˜ëŠ” ìˆ˜ì •ì´ ì™„ë£Œë˜ë©´ `./gradlew test` ë˜ëŠ” `mvn test` ëª…ë ¹ì„ í†µí•´ í…ŒìŠ¤íŠ¸ë¥¼ í• ì§€ ë¬¼ì–´ ë´
â€¢ @SpringBootTest, @WebMvcTest, @DataJpaTest ë“± ì ì ˆí•œ í…ŒìŠ¤íŠ¸ ìŠ¬ë¼ì´ìŠ¤ í™œìš©
â€¢ í…ŒìŠ¤íŠ¸ ë°ì´í„°ëŠ” @Sql ì–´ë…¸í…Œì´ì…˜ì´ë‚˜ í…ŒìŠ¤íŠ¸ìš© ë°ì´í„° ì„¤ì • ì‚¬ìš©

## í”„ë¡œì íŠ¸ êµ¬ì¡°
â€¢ ê³„ì¸µí˜• ì•„í‚¤í…ì²˜ (Controller â†’ Service â†’ Repository)
â€¢ DTO íŒ¨í„´ì„ í™œìš©í•œ ë°ì´í„° ì „ì†¡
â€¢ ì ì ˆí•œ ì˜ˆì™¸ ì²˜ë¦¬ ë° ì—ëŸ¬ í•¸ë“¤ë§
â€¢ ì„¤ì • íŒŒì¼ì€ application.propertiesìš°ì„  ì‚¬ìš©
â€¢ íŒ¨í‚¤ì§€ êµ¬ì¡°ëŠ” ê¸°ëŠ¥ë³„ë¡œ êµ¬ì„±

## ë°ì´í„°ë² ì´ìŠ¤ ë° JPA
â€¢ Entity ì„¤ê³„ ì‹œ ì ì ˆí•œ ì—°ê´€ê´€ê³„ ì„¤ì •
-spring data jpa
â€¢ JPQL, Criteria API, Native Query ì ì ˆíˆ í™œìš©
â€¢ N+1 ë¬¸ì œ ë“± ì„±ëŠ¥ ì´ìŠˆ ê³ ë ¤
â€¢ íŠ¸ëœì­ì…˜ ê´€ë¦¬ (@Transactional) ì ì ˆíˆ í™œìš©

## ì›¹ ê°œë°œ
â€¢ http://localhost:8080 ìœ¼ë¡œ ì ‘ì†í•´ì„œ ì„œë²„ í™•ì¸
â€¢ ë¡œê·¸ëŠ” logback ì„¤ì •ì„ í†µí•´ í™•ì¸
â€¢ ë„¤ì´ë²„ ìŠ¤íƒ€ì¼ì˜ ê¸°ë³¸ ë””ìì¸ ì ìš©
â€¢ tailwind í™œìš©

## ì»¤ë°‹ ë° ë°°í¬
â€¢ ì»¤ë°‹í•  ë• í•­ìƒ ë¹Œë“œê°€ ì˜ ë˜ëŠ” ìƒíƒœì—¬ì•¼ í•˜ê³  í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•˜ëŠ” ìƒíƒœì—¬ì•¼ í•´
â€¢ Git ì»¤ë°‹ ë©”ì‹œì§€ëŠ” Conventional Commits í˜•ì‹ ì‚¬ìš©
â€¢ ë°°í¬ ì „ ë°˜ë“œì‹œ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë° í†µê³¼ í™•ì¸

## ë³´ì•ˆ ë° ì„±ëŠ¥
â€¢ Spring Security ì„¤ì •ì„ í†µí•œ ë³´ì•ˆ ê°•í™”
â€¢ SQL Injection, XSS ë“± ë³´ì•ˆ ì·¨ì•½ì  ë°©ì§€
â€¢ ìºì‹± ì „ëµ ì ì ˆíˆ í™œìš©
â€¢ ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ ë° ì¿¼ë¦¬ ìµœì í™” ê³ ë ¤
</file>

<file path="gradlew">
#!/bin/sh

#
# Copyright Â© 2015-2021 the original authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# SPDX-License-Identifier: Apache-2.0
#

##############################################################################
#
#   Gradle start up script for POSIX generated by Gradle.
#
#   Important for running:
#
#   (1) You need a POSIX-compliant shell to run this script. If your /bin/sh is
#       noncompliant, but you have some other compliant shell such as ksh or
#       bash, then to run this script, type that shell name before the whole
#       command line, like:
#
#           ksh Gradle
#
#       Busybox and similar reduced shells will NOT work, because this script
#       requires all of these POSIX shell features:
#         * functions;
#         * expansions Â«$varÂ», Â«${var}Â», Â«${var:-default}Â», Â«${var+SET}Â»,
#           Â«${var#prefix}Â», Â«${var%suffix}Â», and Â«$( cmd )Â»;
#         * compound commands having a testable exit status, especially Â«caseÂ»;
#         * various built-in commands including Â«commandÂ», Â«setÂ», and Â«ulimitÂ».
#
#   Important for patching:
#
#   (2) This script targets any POSIX shell, so it avoids extensions provided
#       by Bash, Ksh, etc; in particular arrays are avoided.
#
#       The "traditional" practice of packing multiple parameters into a
#       space-separated string is a well documented source of bugs and security
#       problems, so this is (mostly) avoided, by progressively accumulating
#       options in "$@", and eventually passing that to Java.
#
#       Where the inherited environment variables (DEFAULT_JVM_OPTS, JAVA_OPTS,
#       and GRADLE_OPTS) rely on word-splitting, this is performed explicitly;
#       see the in-line comments for details.
#
#       There are tweaks for specific operating systems such as AIX, CygWin,
#       Darwin, MinGW, and NonStop.
#
#   (3) This script is generated from the Groovy template
#       https://github.com/gradle/gradle/blob/HEAD/platforms/jvm/plugins-application/src/main/resources/org/gradle/api/internal/plugins/unixStartScript.txt
#       within the Gradle project.
#
#       You can find Gradle at https://github.com/gradle/gradle/.
#
##############################################################################

# Attempt to set APP_HOME

# Resolve links: $0 may be a link
app_path=$0

# Need this for daisy-chained symlinks.
while
    APP_HOME=${app_path%"${app_path##*/}"}  # leaves a trailing /; empty if no leading path
    [ -h "$app_path" ]
do
    ls=$( ls -ld "$app_path" )
    link=${ls#*' -> '}
    case $link in             #(
      /*)   app_path=$link ;; #(
      *)    app_path=$APP_HOME$link ;;
    esac
done

# This is normally unused
# shellcheck disable=SC2034
APP_BASE_NAME=${0##*/}
# Discard cd standard output in case $CDPATH is set (https://github.com/gradle/gradle/issues/25036)
APP_HOME=$( cd -P "${APP_HOME:-./}" > /dev/null && printf '%s\n' "$PWD" ) || exit

# Use the maximum available, or set MAX_FD != -1 to use that value.
MAX_FD=maximum

warn () {
    echo "$*"
} >&2

die () {
    echo
    echo "$*"
    echo
    exit 1
} >&2

# OS specific support (must be 'true' or 'false').
cygwin=false
msys=false
darwin=false
nonstop=false
case "$( uname )" in                #(
  CYGWIN* )         cygwin=true  ;; #(
  Darwin* )         darwin=true  ;; #(
  MSYS* | MINGW* )  msys=true    ;; #(
  NONSTOP* )        nonstop=true ;;
esac

CLASSPATH=$APP_HOME/gradle/wrapper/gradle-wrapper.jar


# Determine the Java command to use to start the JVM.
if [ -n "$JAVA_HOME" ] ; then
    if [ -x "$JAVA_HOME/jre/sh/java" ] ; then
        # IBM's JDK on AIX uses strange locations for the executables
        JAVACMD=$JAVA_HOME/jre/sh/java
    else
        JAVACMD=$JAVA_HOME/bin/java
    fi
    if [ ! -x "$JAVACMD" ] ; then
        die "ERROR: JAVA_HOME is set to an invalid directory: $JAVA_HOME

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
else
    JAVACMD=java
    if ! command -v java >/dev/null 2>&1
    then
        die "ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
fi

# Increase the maximum file descriptors if we can.
if ! "$cygwin" && ! "$darwin" && ! "$nonstop" ; then
    case $MAX_FD in #(
      max*)
        # In POSIX sh, ulimit -H is undefined. That's why the result is checked to see if it worked.
        # shellcheck disable=SC2039,SC3045
        MAX_FD=$( ulimit -H -n ) ||
            warn "Could not query maximum file descriptor limit"
    esac
    case $MAX_FD in  #(
      '' | soft) :;; #(
      *)
        # In POSIX sh, ulimit -n is undefined. That's why the result is checked to see if it worked.
        # shellcheck disable=SC2039,SC3045
        ulimit -n "$MAX_FD" ||
            warn "Could not set maximum file descriptor limit to $MAX_FD"
    esac
fi

# Collect all arguments for the java command, stacking in reverse order:
#   * args from the command line
#   * the main class name
#   * -classpath
#   * -D...appname settings
#   * --module-path (only if needed)
#   * DEFAULT_JVM_OPTS, JAVA_OPTS, and GRADLE_OPTS environment variables.

# For Cygwin or MSYS, switch paths to Windows format before running java
if "$cygwin" || "$msys" ; then
    APP_HOME=$( cygpath --path --mixed "$APP_HOME" )
    CLASSPATH=$( cygpath --path --mixed "$CLASSPATH" )

    JAVACMD=$( cygpath --unix "$JAVACMD" )

    # Now convert the arguments - kludge to limit ourselves to /bin/sh
    for arg do
        if
            case $arg in                                #(
              -*)   false ;;                            # don't mess with options #(
              /?*)  t=${arg#/} t=/${t%%/*}              # looks like a POSIX filepath
                    [ -e "$t" ] ;;                      #(
              *)    false ;;
            esac
        then
            arg=$( cygpath --path --ignore --mixed "$arg" )
        fi
        # Roll the args list around exactly as many times as the number of
        # args, so each arg winds up back in the position where it started, but
        # possibly modified.
        #
        # NB: a `for` loop captures its iteration list before it begins, so
        # changing the positional parameters here affects neither the number of
        # iterations, nor the values presented in `arg`.
        shift                   # remove old arg
        set -- "$@" "$arg"      # push replacement arg
    done
fi


# Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
DEFAULT_JVM_OPTS='"-Xmx64m" "-Xms64m"'

# Collect all arguments for the java command:
#   * DEFAULT_JVM_OPTS, JAVA_OPTS, and optsEnvironmentVar are not allowed to contain shell fragments,
#     and any embedded shellness will be escaped.
#   * For example: A user cannot expect ${Hostname} to be expanded, as it is an environment variable and will be
#     treated as '${Hostname}' itself on the command line.

set -- \
        "-Dorg.gradle.appname=$APP_BASE_NAME" \
        -classpath "$CLASSPATH" \
        org.gradle.wrapper.GradleWrapperMain \
        "$@"

# Stop when "xargs" is not available.
if ! command -v xargs >/dev/null 2>&1
then
    die "xargs is not available"
fi

# Use "xargs" to parse quoted args.
#
# With -n1 it outputs one arg per line, with the quotes and backslashes removed.
#
# In Bash we could simply go:
#
#   readarray ARGS < <( xargs -n1 <<<"$var" ) &&
#   set -- "${ARGS[@]}" "$@"
#
# but POSIX shell has neither arrays nor command substitution, so instead we
# post-process each arg (as a line of input to sed) to backslash-escape any
# character that might be a shell metacharacter, then use eval to reverse
# that process (while maintaining the separation between arguments), and wrap
# the whole thing up as a single "set" statement.
#
# This will of course break if any of these variables contains a newline or
# an unmatched quote.
#

eval "set -- $(
        printf '%s\n' "$DEFAULT_JVM_OPTS $JAVA_OPTS $GRADLE_OPTS" |
        xargs -n1 |
        sed ' s~[^-[:alnum:]+,./:=@_]~\\&~g; ' |
        tr '\n' ' '
    )" '"$@"'

exec "$JAVACMD" "$@"
</file>

<file path="gradlew.bat">
@rem
@rem Copyright 2015 the original author or authors.
@rem
@rem Licensed under the Apache License, Version 2.0 (the "License");
@rem you may not use this file except in compliance with the License.
@rem You may obtain a copy of the License at
@rem
@rem      https://www.apache.org/licenses/LICENSE-2.0
@rem
@rem Unless required by applicable law or agreed to in writing, software
@rem distributed under the License is distributed on an "AS IS" BASIS,
@rem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
@rem See the License for the specific language governing permissions and
@rem limitations under the License.
@rem
@rem SPDX-License-Identifier: Apache-2.0
@rem

@if "%DEBUG%"=="" @echo off
@rem ##########################################################################
@rem
@rem  Gradle startup script for Windows
@rem
@rem ##########################################################################

@rem Set local scope for the variables with windows NT shell
if "%OS%"=="Windows_NT" setlocal

set DIRNAME=%~dp0
if "%DIRNAME%"=="" set DIRNAME=.
@rem This is normally unused
set APP_BASE_NAME=%~n0
set APP_HOME=%DIRNAME%

@rem Resolve any "." and ".." in APP_HOME to make it shorter.
for %%i in ("%APP_HOME%") do set APP_HOME=%%~fi

@rem Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
set DEFAULT_JVM_OPTS="-Xmx64m" "-Xms64m"

@rem Find java.exe
if defined JAVA_HOME goto findJavaFromJavaHome

set JAVA_EXE=java.exe
%JAVA_EXE% -version >NUL 2>&1
if %ERRORLEVEL% equ 0 goto execute

echo. 1>&2
echo ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH. 1>&2
echo. 1>&2
echo Please set the JAVA_HOME variable in your environment to match the 1>&2
echo location of your Java installation. 1>&2

goto fail

:findJavaFromJavaHome
set JAVA_HOME=%JAVA_HOME:"=%
set JAVA_EXE=%JAVA_HOME%/bin/java.exe

if exist "%JAVA_EXE%" goto execute

echo. 1>&2
echo ERROR: JAVA_HOME is set to an invalid directory: %JAVA_HOME% 1>&2
echo. 1>&2
echo Please set the JAVA_HOME variable in your environment to match the 1>&2
echo location of your Java installation. 1>&2

goto fail

:execute
@rem Setup the command line

set CLASSPATH=%APP_HOME%\gradle\wrapper\gradle-wrapper.jar


@rem Execute Gradle
"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %GRADLE_OPTS% "-Dorg.gradle.appname=%APP_BASE_NAME%" -classpath "%CLASSPATH%" org.gradle.wrapper.GradleWrapperMain %*

:end
@rem End local scope for the variables with windows NT shell
if %ERRORLEVEL% equ 0 goto mainEnd

:fail
rem Set variable GRADLE_EXIT_CONSOLE if you need the _script_ return code instead of
rem the _cmd.exe /c_ return code!
set EXIT_CODE=%ERRORLEVEL%
if %EXIT_CODE% equ 0 set EXIT_CODE=1
if not ""=="%GRADLE_EXIT_CONSOLE%" exit %EXIT_CODE%
exit /b %EXIT_CODE%

:mainEnd
if "%OS%"=="Windows_NT" endlocal

:omega
</file>

<file path="prd.md">
# ì»¤ë®¤ë‹ˆí‹° ì‚¬ì´íŠ¸ PRD (Product Requirements Document)

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### 1.1 í”„ë¡œì íŠ¸ ëª©í‘œ
- ì‚¬ìš©ìë“¤ì´ ììœ ë¡­ê²Œ ì†Œí†µí•  ìˆ˜ ìˆëŠ” ì»¤ë®¤ë‹ˆí‹° í”Œë«í¼ ê°œë°œ
- ê²Œì‹œê¸€ ì‘ì„±, ëŒ“ê¸€, ì¢‹ì•„ìš” ë“±ì˜ ê¸°ë³¸ ì»¤ë®¤ë‹ˆí‹° ê¸°ëŠ¥ ì œê³µ
- ì‹¤ì‹œê°„ ì†Œí†µì´ ê°€ëŠ¥í•œ í˜„ëŒ€ì ì¸ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¶•

### 1.2 ê¸°ìˆ  ìŠ¤íƒ
- **Backend**: Spring Boot 3.x, Spring Security, JPA/Hibernate
- **Frontend**: React 18, Tailwind CSS
- **Database**: MySQL 
- **ì¸ì¦**: oauth2
- **ì¸ê°€**: jwt 
- **Build Tool**: Gradle

## 2. í•µì‹¬ ê¸°ëŠ¥

### 2.1 ì‚¬ìš©ì ê´€ë¦¬
- **íšŒì›ê°€ì…/ë¡œê·¸ì¸**
  - ì´ë©”ì¼ ê¸°ë°˜ íšŒì›ê°€ì…
  - ì†Œì…œ ë¡œê·¸ì¸ (Google) ì˜µì…˜
  - ì´ë©”ì¼ ì¸ì¦ ê¸°ëŠ¥
  - ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •

- **í”„ë¡œí•„ ê´€ë¦¬**
  - í”„ë¡œí•„ ì‚¬ì§„ ì—…ë¡œë“œ
  - ë‹‰ë„¤ì„, ìê¸°ì†Œê°œ ìˆ˜ì •
  - í™œë™ ë‚´ì—­ ì¡°íšŒ

### 2.2 ê²Œì‹œíŒ ê¸°ëŠ¥
- **ê²Œì‹œê¸€ ê´€ë¦¬**
  - ê²Œì‹œê¸€ ì‘ì„±/ìˆ˜ì •/ì‚­ì œ
  - ì¹´í…Œê³ ë¦¬ë³„ ê²Œì‹œíŒ êµ¬ì„±
  - ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œ
  - ë§ˆí¬ë‹¤ìš´ ì—ë””í„° ì§€ì›
  - ê²Œì‹œê¸€ ê²€ìƒ‰ ê¸°ëŠ¥

- **ëŒ“ê¸€ ì‹œìŠ¤í…œ**
  - ëŒ“ê¸€ ì‘ì„±/ìˆ˜ì •/ì‚­ì œ
  - ëŒ€ëŒ“ê¸€ ê¸°ëŠ¥
  - ëŒ“ê¸€ ì¢‹ì•„ìš”/ì‹«ì–´ìš”

### 2.3 ì†Œì…œ ê¸°ëŠ¥
- **ì¢‹ì•„ìš”/ë¶ë§ˆí¬**
  - ê²Œì‹œê¸€ ì¢‹ì•„ìš”/ì‹«ì–´ìš”
  - ê²Œì‹œê¸€ ë¶ë§ˆí¬
  - ë‚´ê°€ ì¢‹ì•„ìš”í•œ ê²Œì‹œê¸€ ëª¨ìŒ

- **íŒ”ë¡œìš° ì‹œìŠ¤í…œ**
  - ë‹¤ë¥¸ ì‚¬ìš©ì íŒ”ë¡œìš°/ì–¸íŒ”ë¡œìš°
  - íŒ”ë¡œì‰/íŒ”ë¡œì›Œ ëª©ë¡
  - íŒ”ë¡œìš°í•œ ì‚¬ìš©ì ê²Œì‹œê¸€ í”¼ë“œ

### 2.4 ê´€ë¦¬ì ê¸°ëŠ¥
- **ì‚¬ìš©ì ê´€ë¦¬**
  - ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
  - ì‚¬ìš©ì ì •ì§€/ë³µêµ¬
  - ê¶Œí•œ ê´€ë¦¬

- **ê²Œì‹œê¸€ ê´€ë¦¬**
  - ë¶€ì ì ˆí•œ ê²Œì‹œê¸€ ì‚­ì œ
  - ì‹ ê³  ì²˜ë¦¬
  - ê³µì§€ì‚¬í•­ ê´€ë¦¬

## 3. í™”ë©´ êµ¬ì„±

### 3.1 ë©”ì¸ í˜ì´ì§€
- ìµœì‹  ê²Œì‹œê¸€ ëª©ë¡
- ì¸ê¸° ê²Œì‹œê¸€ ëª©ë¡
- ì¹´í…Œê³ ë¦¬ë³„ ìµœì‹  ê²Œì‹œê¸€
- ê²€ìƒ‰ ê¸°ëŠ¥

### 3.2 ê²Œì‹œíŒ í˜ì´ì§€
- ì¹´í…Œê³ ë¦¬ë³„ ê²Œì‹œê¸€ ëª©ë¡
- í˜ì´ì§• ì²˜ë¦¬
- ì •ë ¬ ê¸°ëŠ¥ (ìµœì‹ ìˆœ, ì¸ê¸°ìˆœ, ì¡°íšŒìˆœ)
- í•„í„° ê¸°ëŠ¥

### 3.3 ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€
- ê²Œì‹œê¸€ ë‚´ìš© í‘œì‹œ
- ëŒ“ê¸€ ëª©ë¡
- ì¢‹ì•„ìš”/ë¶ë§ˆí¬ ë²„íŠ¼
- ê³µìœ  ê¸°ëŠ¥

### 3.4 ì‚¬ìš©ì í˜ì´ì§€
- ê°œì¸ í”„ë¡œí•„
- ì‘ì„±í•œ ê²Œì‹œê¸€ ëª©ë¡
- ëŒ“ê¸€ ëª©ë¡
- ì¢‹ì•„ìš”í•œ ê²Œì‹œê¸€ ëª©ë¡

## 4. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### 4.1 ì£¼ìš” í…Œì´ë¸”
- **users**: ì‚¬ìš©ì ì •ë³´
- **posts**: ê²Œì‹œê¸€ ì •ë³´
- **comments**: ëŒ“ê¸€ ì •ë³´
- **categories**: ì¹´í…Œê³ ë¦¬ ì •ë³´
- **likes**: ì¢‹ì•„ìš” ì •ë³´
- **follows**: íŒ”ë¡œìš° ê´€ê³„
- **bookmarks**: ë¶ë§ˆí¬ ì •ë³´

### 4.2 ERD ì£¼ìš” ê´€ê³„
- User 1:N Post
- User 1:N Comment
- Post 1:N Comment
- User M:N User (íŒ”ë¡œìš°)
- User M:N Post (ì¢‹ì•„ìš”, ë¶ë§ˆí¬)

## 5. API ì„¤ê³„

### 5.1 ì¸ì¦ API
- `POST /api/auth/register` - íšŒì›ê°€ì…
- `POST /api/auth/login` - ë¡œê·¸ì¸
- `POST /api/auth/logout` - ë¡œê·¸ì•„ì›ƒ
- `POST /api/auth/refresh` - í† í° ê°±ì‹ 

### 5.2 ê²Œì‹œê¸€ API
- `GET /api/posts` - ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ
- `GET /api/posts/{id}` - ê²Œì‹œê¸€ ìƒì„¸ ì¡°íšŒ
- `POST /api/posts` - ê²Œì‹œê¸€ ì‘ì„±
- `PUT /api/posts/{id}` - ê²Œì‹œê¸€ ìˆ˜ì •
- `DELETE /api/posts/{id}` - ê²Œì‹œê¸€ ì‚­ì œ

### 5.3 ëŒ“ê¸€ API
- `GET /api/posts/{postId}/comments` - ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ
- `POST /api/posts/{postId}/comments` - ëŒ“ê¸€ ì‘ì„±
- `PUT /api/comments/{id}` - ëŒ“ê¸€ ìˆ˜ì •
- `DELETE /api/comments/{id}` - ëŒ“ê¸€ ì‚­ì œ

### 5.4 ì‚¬ìš©ì API
- `GET /api/users/profile` - ë‚´ í”„ë¡œí•„ ì¡°íšŒ
- `PUT /api/users/profile` - í”„ë¡œí•„ ìˆ˜ì •
- `GET /api/users/{id}` - ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
- `POST /api/users/{id}/follow` - íŒ”ë¡œìš°
- `DELETE /api/users/{id}/follow` - ì–¸íŒ”ë¡œìš°

## 6. ë¹„ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

### 6.1 ë³´ì•ˆ
- oauth2ê¸°ë°˜ ì¸ì¦
- CORS ì„¤ì •
- SQL Injection ë°©ì§€
- XSS ë°©ì§€
- CSRF ë°©ì§€

### 6.2 ì„±ëŠ¥
- ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ ìµœì í™”
- í˜ì´ì§• ì²˜ë¦¬
- ì´ë¯¸ì§€ ìµœì í™”
- ìºì‹± ì „ëµ

### 6.3 ì‚¬ìš©ì„±
- ë°˜ì‘í˜• ë””ìì¸
- ì§ê´€ì ì¸ UI/UX
- ë¹ ë¥¸ ë¡œë”© ì‹œê°„
- ì ‘ê·¼ì„± ê³ ë ¤

## 7. ê°œë°œ ê³„íš

### 7.1 Phase 1 (í•µì‹¬ ê¸°ëŠ¥)
- ì‚¬ìš©ì ì¸ì¦ ì‹œìŠ¤í…œ
- ê¸°ë³¸ ê²Œì‹œíŒ ê¸°ëŠ¥
- ëŒ“ê¸€ ì‹œìŠ¤í…œ

### 7.2 Phase 2 (ì†Œì…œ ê¸°ëŠ¥)
- ì¢‹ì•„ìš”/ë¶ë§ˆí¬ ê¸°ëŠ¥
- íŒ”ë¡œìš° ì‹œìŠ¤í…œ
- ê²€ìƒ‰ ê¸°ëŠ¥

### 7.3 Phase 3 (ê³ ê¸‰ ê¸°ëŠ¥)
- ê´€ë¦¬ì ê¸°ëŠ¥
- ì•Œë¦¼ ì‹œìŠ¤í…œ
- ì‹¤ì‹œê°„ ì±„íŒ…

## 8. ë°°í¬ ë° ìš´ì˜

### 8.1 ë°°í¬ í™˜ê²½

- Docker ì»¨í…Œì´ë„ˆ ì‚¬ìš©
- CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•

### 8.2 ëª¨ë‹ˆí„°ë§
- ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ ê´€ë¦¬
- ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
- ì—ëŸ¬ ì¶”ì  ì‹œìŠ¤í…œ

## 9. ì˜ˆìƒ ì¼ì •
- **ì„¤ê³„ ë° í™˜ê²½ êµ¬ì¶•**: 1ì£¼
- **Phase 1 ê°œë°œ**: 3ì£¼
- **Phase 2 ê°œë°œ**: 2ì£¼
- **Phase 3 ê°œë°œ**: 2ì£¼
- **í…ŒìŠ¤íŠ¸ ë° ë°°í¬**: 1ì£¼

ì´ ì˜ˆìƒ ê¸°ê°„: ì•½ 9ì£¼
</file>

</files>
